const e=["onValueChange","value"];var t,n,i,a,l,o,r,s,d,c,u,p,h,g,m,y,f,v,b,x,C,w,I,T,k,_,S,R,E,z,A,O,D,q,L,j,F,P,U,M,N,V;function Q(e,t){if(null==e)return{};var n,i,a=function(e,t){if(null==e)return{};var n,i,a={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach((function(t){H(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function H(e,t,n){return(t=function(e){var t=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var i=n.call(e,t||"default");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:String(t)}(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Y(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}import{useClient as $,useDocumentStore as W,WithReferringDocuments as G,useSchema as K,Preview as Z,useFormValue as J,definePlugin as ee}from"sanity";import{ThLargeIcon as te,ThListIcon as ne,SortIcon as ie,SelectIcon as ae,CloseIcon as le,AddCircleIcon as oe,SearchIcon as re,PlugIcon as se,ClipboardIcon as de,DownloadIcon as ce,ChevronDownIcon as ue,AddIcon as pe,ErrorOutlineIcon as he,WarningOutlineIcon as ge,EditIcon as me,ArrowUpIcon as ye,ArrowDownIcon as fe,TrashIcon as ve,ComposeIcon as be,Icon as xe,UploadIcon as Ce,WarningFilledIcon as we,CheckmarkCircleIcon as Ie,ChevronUpIcon as Te,ImageIcon as ke}from"@sanity/icons";import{jsx as _e,jsxs as Se,Fragment as Re}from"react/jsx-runtime";import{Inline as Ee,Button as ze,MenuButton as Ae,Menu as Oe,MenuItem as De,MenuDivider as qe,Box as Le,Flex as je,Label as Fe,Text as Pe,TextInput as Ue,studioTheme as Me,Card as Ne,MenuGroup as Ve,useMediaIndex as Qe,Tooltip as Be,Switch as Xe,Popover as He,Stack as Ye,Dialog as $e,TextArea as We,TabList as Ge,Tab as Ke,TabPanel as Ze,Select as Je,Container as et,Spinner as tt,Checkbox as nt,Grid as it,useToast as at,ThemeProvider as lt,ToastProvider as ot,useLayer as rt,PortalProvider as st,Portal as dt}from"@sanity/ui";import{useRef as ct,useEffect as ut,createContext as pt,useContext as ht,useState as gt,forwardRef as mt,useCallback as yt,memo as ft,Component as vt}from"react";import bt from"is-hotkey";import xt from"groq";import{useSelector as Ct,useDispatch as wt,Provider as It}from"react-redux";import{createAction as Tt,createSlice as kt,createSelector as _t,combineReducers as St,configureStore as Rt}from"@reduxjs/toolkit";import{nanoid as Et}from"nanoid";import{ofType as zt,combineEpics as At,createEpicMiddleware as Ot}from"redux-observable";import{iif as Dt,throwError as qt,of as Lt,from as jt,empty as Ft,Subject as Pt,Observable as Ut,merge as Mt}from"rxjs";import{delay as Nt,mergeMap as Vt,filter as Qt,withLatestFrom as Bt,catchError as Xt,switchMap as Ht,bufferTime as Yt,debounceTime as $t,first as Wt,map as Gt,takeUntil as Kt}from"rxjs/operators";import{hues as Zt,white as Jt,black as en}from"@sanity/color";import tn,{css as nn,createGlobalStyle as an}from"styled-components";import ln from"pluralize";import{useNProgress as on}from"@tanem/react-nprogress";import rn,{components as sn}from"react-select";import{Virtuoso as dn,VirtuosoGrid as cn,GroupedVirtuoso as un}from"react-virtuoso";import{yupResolver as pn}from"@hookform/resolvers/yup";import{Controller as hn,useForm as gn}from"react-hook-form";import*as mn from"yup";import yn from"date-fns/format";import fn from"filesize";import vn from"copy-to-clipboard";import{useIntentLink as bn}from"sanity/router";import{FileIcon as xn,defaultStyles as Cn}from"react-file-icon";import wn from"react-select/creatable";import In from"date-fns/formatRelative";import{useDropzone as Tn}from"react-dropzone";const kn=(e,t)=>{const n=ct(!1);function i(i){bt(e,i)&&(n.current=!0,t&&t())}const a=()=>{n.current=!1};return ut((()=>(window.addEventListener("keydown",i),window.addEventListener("keyup",a),()=>{window.removeEventListener("keydown",i),window.removeEventListener("keyup",a)})),[]),n},_n={type:"divider"},Sn={altText:{assetTypes:["file","image"],field:"altText",name:"altText",operatorType:"empty",operatorTypes:["empty","notEmpty",null,"includes","doesNotInclude"],title:"Alt text",type:"string",value:""},description:{assetTypes:["file","image"],field:"description",name:"description",operatorType:"empty",operatorTypes:["empty","notEmpty",null,"includes","doesNotInclude"],title:"Description",type:"string",value:""},fileName:{assetTypes:["file","image"],field:"originalFilename",name:"filename",operatorType:"includes",operatorTypes:["includes","doesNotInclude"],title:"File name",type:"string",value:""},height:{assetTypes:["image"],field:"metadata.dimensions.height",name:"height",operatorType:"greaterThan",operatorTypes:["greaterThan","greaterThanOrEqualTo","lessThan","lessThanOrEqualTo",null,"equalTo"],title:"Height",type:"number",value:400},inCurrentDocument:{assetTypes:["file","image"],name:"inCurrentDocument",operatorType:"is",options:[{name:"true",title:"True",value:xt(t||(t=Y(["_id in $documentAssetIds"])))},{name:"false",title:"False",value:xt(n||(n=Y(["!(_id in $documentAssetIds)"])))}],selectOnly:!0,title:"In use in current document",type:"select",value:"true"},inUse:{assetTypes:["file","image"],name:"inUse",operatorType:"is",options:[{name:"true",title:"True",value:xt(i||(i=Y(["count(*[references(^._id)]) > 0"])))},{name:"false",title:"False",value:xt(a||(a=Y(["count(*[references(^._id)]) == 0"])))}],title:"In use",type:"select",value:"true"},isOpaque:{assetTypes:["image"],field:"metadata.isOpaque",name:"isOpaque",operatorType:"equalTo",options:[{name:"true",title:"True",value:"false"},{name:"false",title:"False",value:"true"}],title:"Has transparency",type:"select",value:"true"},orientation:{assetTypes:["image"],name:"orientation",operatorType:"is",operatorTypes:["is","isNot"],options:[{name:"portrait",title:"Portrait",value:"metadata.dimensions.aspectRatio < 1"},{name:"landscape",title:"Landscape",value:"metadata.dimensions.aspectRatio > 1"},{name:"square",title:"Square",value:"metadata.dimensions.aspectRatio == 1"}],title:"Orientation",type:"select",value:"portrait"},size:{assetTypes:["file","image"],field:"size",modifier:"kb",modifiers:[{name:"kb",title:"KB",fieldModifier:e=>"round(".concat(e," / 1000)")},{name:"mb",title:"MB",fieldModifier:e=>"round(".concat(e," / 1000000)")}],name:"size",operatorType:"greaterThan",operatorTypes:["greaterThan","greaterThanOrEqualTo","lessThan","lessThanOrEqualTo",null,"equalTo"],title:"File size",type:"number",value:0},tag:{assetTypes:["file","image"],field:"opt.media.tags",name:"tag",operatorType:"references",operatorTypes:["references","doesNotReference",null,"empty","notEmpty"],title:"Tags",type:"searchable"},title:{assetTypes:["file","image"],field:"title",name:"title",operatorType:"empty",operatorTypes:["empty","notEmpty",null,"includes","doesNotInclude"],title:"Title",type:"string",value:""},type:{assetTypes:["file","image"],name:"type",operatorType:"is",operatorTypes:["is","isNot"],options:[{name:"image",title:"Image",value:'mimeType match "image*"'},{name:"video",title:"Video",value:'mimeType match "video*"'},{name:"audio",title:"Audio",value:'mimeType match "audio*"'},{name:"pdf",title:"PDF",value:'mimeType == "application/pdf"'}],title:"File type",type:"select",value:"image"},width:{assetTypes:["image"],field:"metadata.dimensions.width",name:"width",operatorType:"greaterThan",operatorTypes:["greaterThan","greaterThanOrEqualTo","lessThan","lessThanOrEqualTo",null,"equalTo"],title:"Width",type:"number",value:400}},Rn={doesNotInclude:{fn:(e,t)=>e?"!(".concat(t," match '*").concat(e,"*')"):void 0,label:"does not include"},doesNotReference:{fn:(e,t)=>e?"!references('".concat(e,"')"):void 0,label:"does not include"},empty:{fn:(e,t)=>"!defined(".concat(t,")"),hideInput:!0,label:"is empty"},equalTo:{fn:(e,t)=>e?"".concat(t," == ").concat(e):void 0,label:"is equal to"},greaterThan:{fn:(e,t)=>e?"".concat(t," > ").concat(e):void 0,label:"is greater than"},greaterThanOrEqualTo:{fn:(e,t)=>e?"".concat(t," >= ").concat(e):void 0,label:"is greater than or equal to"},includes:{fn:(e,t)=>e?"".concat(t," match '*").concat(e,"*'"):void 0,label:"includes"},is:{fn:(e,t)=>"".concat(e),label:"is"},isNot:{fn:(e,t)=>"!(".concat(e,")"),label:"is not"},lessThan:{fn:(e,t)=>e?"".concat(t," < ").concat(e):void 0,label:"is less than"},lessThanOrEqualTo:{fn:(e,t)=>e?"".concat(t," <= ").concat(e):void 0,label:"is less than or equal to"},notEmpty:{fn:(e,t)=>"defined(".concat(t,")"),hideInput:!0,label:"is not empty"},references:{fn:(e,t)=>e?"references('".concat(e,"')"):void 0,label:"includes"}},En=[{direction:"desc",field:"_createdAt"},{direction:"asc",field:"_createdAt"},null,{direction:"desc",field:"_updatedAt"},{direction:"asc",field:"_updatedAt"},null,{direction:"asc",field:"originalFilename"},{direction:"desc",field:"originalFilename"},null,{direction:"desc",field:"size"},{direction:"asc",field:"size"}],zn=[Sn.tag,_n,Sn.inUse,Sn.inCurrentDocument,_n,Sn.title,Sn.altText,Sn.description,_n,Sn.isOpaque,_n,Sn.fileName,Sn.size,Sn.type,_n,Sn.orientation,Sn.width,Sn.height],An="3rem 100px auto 1.5rem",On="3rem 100px auto 5.5rem 5.5rem 3.5rem 8.5rem 2rem",Dn=32,qn="media.tag",Ln=pt(void 0),jn=e=>{const{children:t,onSelect:n}=e,i={onSelect:n};return _e(Ln.Provider,{value:i,children:t})},Fn=()=>{const e=ht(Ln);if(void 0===e)throw new Error("useAssetSourceActions must be used within an AssetSourceDispatchProvider");return e},Pn=()=>$({apiVersion:"2022-10-01"}),Un={_createdAt:{asc:"Last created: Oldest first",desc:"Last created: Newest first"},_updatedAt:{asc:"Last updated: Oldest first",desc:"Last updated: Newest first"},mimeType:{asc:"MIME type: A to Z",desc:"MIME type: Z to A"},originalFilename:{asc:"File name: A to Z",desc:"File name: Z to A"},size:{asc:"File size: Smallest first",desc:"File size: Largest first"}},Mn=(e,t)=>Un[e][t],Nn=e=>function(t){return Dt((()=>!!e),t.pipe(Nt(3e3),Vt((e=>Math.random()>.5?qt({message:"Test error",statusCode:500}):Lt(e)))),t)},Vn=e=>{let{assetTypes:t,searchFacets:n,searchQuery:i}=e;const a=t.map((e=>"sanity.".concat(e,"Asset"))),r=xt(l||(l=Y(["\n    _type in ",' && !(_id in path("drafts.**"))\n  '])),JSON.stringify(a)),s=n.reduce(((e,t)=>{var n;if("number"===t.type){const{field:n,modifier:i,modifiers:a,operatorType:l,value:o}=t,r=Rn[l],s=null==a?void 0:a.find((e=>e.name===i)),d=(null==s?void 0:s.fieldModifier)?s.fieldModifier(n):n,c=r.fn(o,d);c&&e.push(c)}if("searchable"===t.type){const{field:n,operatorType:i,value:a}=t,l=Rn[i].fn(null==a?void 0:a.value,n);l&&e.push(l)}if("select"===t.type){const{field:i,operatorType:a,options:l,value:o}=t,r=Rn[a],s=null==(n=null==l?void 0:l.find((e=>e.name===o)))?void 0:n.value,d=r.fn(s,i);d&&e.push(d)}if("string"===t.type){const{field:n,operatorType:i,value:a}=t,l=Rn[i].fn(a,n);l&&e.push(l)}return e}),[]);return[r,...i?[xt(o||(o=Y(["[_id, altText, assetId, description, originalFilename, title, url] match '*","*'"])),i.trim())]:[],...s].join(" && ")},Qn=(e,t)=>function(n){return n.pipe(Vt((()=>jt(e.fetch(xt(r||(r=Y(['count(*[_type == "','" && name.current == $name])'])),qn),{name:t})))),Vt((e=>e>0?qt({message:"Tag already exists",statusCode:409}):Lt(!0))))},Bn=e=>e.reduce(((e,t)=>{var n;const i=null==t?void 0:t.tag;return i&&e.push({label:null==(n=null==i?void 0:i.name)?void 0:n.current,value:null==i?void 0:i._id}),e}),[]),Xn={tagsAddComplete:Tt("actions/tagsAddComplete",(function(e){let{assets:t,tag:n}=e;return{payload:{assets:t,tag:n}}})),tagsAddError:Tt("actions/tagsAddError",(function(e){let{assets:t,error:n,tag:i}=e;return{payload:{assets:t,error:n,tag:i}}})),tagsAddRequest:Tt("actions/tagsAddRequest",(function(e){let{assets:t,tag:n}=e;return{payload:{assets:t,tag:n}}})),tagsRemoveComplete:Tt("actions/tagsRemoveComplete",(function(e){let{assets:t,tag:n}=e;return{payload:{assets:t,tag:n}}})),tagsRemoveError:Tt("actions/tagsRemoveError",(function(e){let{assets:t,error:n,tag:i}=e;return{payload:{assets:t,error:n,tag:i}}})),tagsRemoveRequest:Tt("actions/tagsRemoveRequest",(function(e){let{assets:t,tag:n}=e;return{payload:{assets:t,tag:n}}}))},Hn={showTagCreate:Tt("dialog/showTagCreate"),showTagEdit:Tt("dialog/showTagEdit",(function(e){let{tagId:t}=e;return{payload:{tagId:t}}}))},Yn=kt({name:"tags",initialState:{allIds:[],byIds:{},creating:!1,creatingError:void 0,fetchCount:-1,fetching:!1,fetchingError:void 0,panelVisible:!0},extraReducers:e=>{e.addCase(Hn.showTagCreate,(e=>{delete e.creatingError})).addCase(Hn.showTagEdit,((e,t)=>{const{tagId:n}=t.payload;delete e.byIds[n].error})).addMatcher((e=>[Xn.tagsAddComplete.type,Xn.tagsAddError.type,Xn.tagsRemoveComplete.type,Xn.tagsRemoveError.type].includes(e.type)),((e,t)=>{const{tag:n}=t.payload;e.byIds[n._id].updating=!1})).addMatcher((e=>[Xn.tagsAddRequest.type,Xn.tagsRemoveRequest.type].includes(e.type)),((e,t)=>{const{tag:n}=t.payload;e.byIds[n._id].updating=!0}))},reducers:{createComplete(e,t){const{tag:n}=t.payload;e.creating=!1,e.allIds.includes(n._id)||e.allIds.push(n._id),e.byIds[n._id]={_type:"tag",picked:!1,tag:n,updating:!1}},createError(e,t){e.creating=!1,e.creatingError=t.payload.error},createRequest(e,t){e.creating=!0,delete e.creatingError},deleteComplete(e,t){const{tagId:n}=t.payload,i=e.allIds.indexOf(n);i>=0&&e.allIds.splice(i,1),delete e.byIds[n]},deleteError(e,t){const{error:n,tag:i}=t.payload,a=null==i?void 0:i._id;e.byIds[a].error=n,e.byIds[a].updating=!1},deleteRequest(e,t){var n,i;const a=null==(i=null==(n=t.payload)?void 0:n.tag)?void 0:i._id;e.byIds[a].picked=!1,e.byIds[a].updating=!0,Object.keys(e.byIds).forEach((t=>{delete e.byIds[t].error}))},fetchComplete(e,t){const{tags:n}=t.payload;null==n||n.forEach((t=>{e.allIds.push(t._id),e.byIds[t._id]={_type:"tag",picked:!1,tag:t,updating:!1}})),e.fetching=!1,e.fetchCount=n.length||0,delete e.fetchingError},fetchError(e,t){const{error:n}=t.payload;e.fetching=!1,e.fetchingError=n},fetchRequest:{reducer:(e,t)=>{e.fetching=!0,delete e.fetchingError},prepare:()=>({payload:{query:xt(s||(s=Y(['\n          {\n            "items": *[\n              _type == "','"\n              && !(_id in path("drafts.**"))\n            ] {\n              _createdAt,\n              _updatedAt,\n              _id,\n              _rev,\n              _type,\n              name\n            } | order(name.current asc),\n          }\n        '])),qn)}})},listenerCreateQueue(e,t){},listenerCreateQueueComplete(e,t){const{tags:n}=t.payload;null==n||n.forEach((t=>{e.byIds[t._id]={_type:"tag",picked:!1,tag:t,updating:!1},e.allIds.includes(t._id)||e.allIds.push(t._id)}))},listenerDeleteQueue(e,t){},listenerDeleteQueueComplete(e,t){const{tagIds:n}=t.payload;null==n||n.forEach((t=>{const n=e.allIds.indexOf(t);n>=0&&e.allIds.splice(n,1),delete e.byIds[t]}))},listenerUpdateQueue(e,t){},listenerUpdateQueueComplete(e,t){const{tags:n}=t.payload;null==n||n.forEach((t=>{e.byIds[t._id]&&(e.byIds[t._id].tag=t)}))},panelVisibleSet(e,t){const{panelVisible:n}=t.payload;e.panelVisible=n},sort(e){e.allIds.sort(((t,n)=>{const i=e.byIds[t].tag.name.current,a=e.byIds[n].tag.name.current;return i<a?-1:i>a?1:0}))},updateComplete(e,t){const{tag:n}=t.payload;e.byIds[n._id].tag=n,e.byIds[n._id].updating=!1},updateError(e,t){const{error:n,tag:i}=t.payload,a=null==i?void 0:i._id;e.byIds[a].error=n,e.byIds[a].updating=!1},updateRequest(e,t){const{tag:n}=t.payload;e.byIds[null==n?void 0:n._id].updating=!0}}}),$n=e=>e.tags.byIds,Wn=_t([$n,e=>e.tags.allIds],((e,t)=>t.map((t=>e[t])))),Gn=_t([$n,(e,t)=>t],((e,t)=>e[t])),Kn=Yn.actions;var Zn=Yn.reducer;const Jn=kt({name:"search",initialState:{facets:[],query:""},reducers:{facetsAdd(e,t){e.facets.push(t.payload.facet)},facetsClear(e){e.facets=[]},facetsRemove(e,t){e.facets=e.facets.filter((e=>e.name!==t.payload.facetName))},facetsUpdate(e,t){const{modifier:n,name:i,operatorType:a,value:l}=t.payload;e.facets.forEach(((t,o)=>{t.name===i&&("number"===t.type&&n&&(t.modifier=n),a&&(t.operatorType=a),void 0!==l&&(e.facets[o].value=l))}))},querySet(e,t){var n;e.query=null==(n=t.payload)?void 0:n.searchQuery}}}),ei=_t((e=>e.search.facets),(e=>!!(null==e?void 0:e.find((e=>"tag"===e.name))))),ti=_t([e=>e.tags.byIds,e=>e.search.facets,(e,t)=>t],((e,t,n)=>{var i,a,l;const o=null==t?void 0:t.find((e=>"tag"===e.name));if("searchable"===(null==o?void 0:o.type)){const t=null==(i=o.value)?void 0:i.value;if(t)return(null==(l=null==(a=e[t])?void 0:a.tag)?void 0:l._id)===n&&"references"===(null==o?void 0:o.operatorType)}return!1})),ni=Jn.actions;var ii=Jn.reducer;const ai={uploadComplete:Tt("uploads/uploadComplete",(function(e){let{asset:t}=e;return{payload:{asset:t}}}))},li=En[0],oi={allIds:[],assetTypes:[],byIds:{},fetchCount:-1,fetching:!1,fetchingError:void 0,lastPicked:void 0,order:{direction:li.direction,field:li.field,title:Mn(li.field,li.direction)},pageIndex:0,pageSize:50,view:"grid"},ri=kt({name:"assets",initialState:oi,extraReducers:e=>{e.addCase(ai.uploadComplete,((e,t)=>{const{asset:n}=t.payload;e.byIds[n._id]={_type:"asset",asset:n,picked:!1,updating:!1}})).addCase(Xn.tagsAddComplete,((e,t)=>{const{assets:n}=t.payload;n.forEach((t=>{e.byIds[t.asset._id].updating=!1}))})).addCase(Xn.tagsAddError,((e,t)=>{const{assets:n}=t.payload;n.forEach((t=>{e.byIds[t.asset._id].updating=!1}))})).addCase(Xn.tagsAddRequest,((e,t)=>{const{assets:n}=t.payload;n.forEach((t=>{e.byIds[t.asset._id].updating=!0}))})).addCase(Xn.tagsRemoveComplete,((e,t)=>{const{assets:n}=t.payload;n.forEach((t=>{e.byIds[t.asset._id].updating=!1}))})).addCase(Xn.tagsRemoveError,((e,t)=>{const{assets:n}=t.payload;n.forEach((t=>{e.byIds[t.asset._id].updating=!1}))})).addCase(Xn.tagsRemoveRequest,((e,t)=>{const{assets:n}=t.payload;n.forEach((t=>{e.byIds[t.asset._id].updating=!0}))}))},reducers:{clear(e){e.allIds=[]},deleteComplete(e,t){const{assetIds:n}=t.payload;null==n||n.forEach((t=>{const n=e.allIds.indexOf(t);n>=0&&e.allIds.splice(n,1),delete e.byIds[t]})),e.pageIndex=Math.floor(e.allIds.length/e.pageSize)-1},deleteError(e,t){var n,i,a,l;const{assetIds:o,error:r}=t.payload,s=null==(l=null==(a=null==(i=null==(n=null==r?void 0:r.response)?void 0:n.body)?void 0:i.error)?void 0:a.items)?void 0:l.map((e=>e.error));null==o||o.forEach((t=>{e.byIds[t].updating=!1})),null==s||s.forEach((t=>{e.byIds[t.id].error=t.description}))},deleteRequest(e,t){const{assets:n}=t.payload;n.forEach((t=>{e.byIds[null==t?void 0:t._id].updating=!0})),Object.keys(e.byIds).forEach((t=>{delete e.byIds[t].error}))},fetchComplete(e,t){var n;const i=(null==(n=t.payload)?void 0:n.assets)||[];i&&i.forEach((t=>{e.allIds.includes(t._id)||e.allIds.push(t._id),e.byIds[t._id]={_type:"asset",asset:t,picked:!1,updating:!1}})),e.fetching=!1,e.fetchCount=i.length||0,delete e.fetchingError},fetchError(e,t){const n=t.payload;e.fetching=!1,e.fetchingError=n},fetchRequest:{reducer:(e,t)=>{e.fetching=!0,delete e.fetchingError},prepare:e=>{let{params:t={},queryFilter:n,selector:i="",sort:a=xt(c||(c=Y(["order(_updatedAt desc)"])))}=e;const l=a||i?"|":"";return{payload:{params:t,query:xt(u||(u=Y(['\n          {\n            "items": *[',"] {\n              _id,\n              _type,\n              _createdAt,\n              _updatedAt,\n              altText,\n              description,\n              extension,\n              renewDate,\n              isLicensed,\n              metadata {\n                dimensions,\n                exif,\n                isOpaque,\n              },\n              mimeType,\n              opt {\n                media\n              },\n              originalFilename,\n              size,\n              title,\n              url\n            } "," "," ",",\n          }\n        "])),n,l,a,i)}}}},insertUploads(e,t){const{results:n}=t.payload;Object.entries(n).forEach((t=>{let[n,i]=t;i&&!e.allIds.includes(n)&&e.allIds.push(i)}))},listenerCreateQueue(e,t){},listenerCreateQueueComplete(e,t){const{assets:n}=t.payload;null==n||n.forEach((t=>{var n;(null==(n=e.byIds[null==t?void 0:t._id])?void 0:n.asset)&&(e.byIds[t._id].asset=t)}))},listenerDeleteQueue(e,t){},listenerDeleteQueueComplete(e,t){const{assetIds:n}=t.payload;null==n||n.forEach((t=>{const n=e.allIds.indexOf(t);n>=0&&e.allIds.splice(n,1),delete e.byIds[t]}))},listenerUpdateQueue(e,t){},listenerUpdateQueueComplete(e,t){const{assets:n}=t.payload;null==n||n.forEach((t=>{var n;(null==(n=e.byIds[null==t?void 0:t._id])?void 0:n.asset)&&(e.byIds[t._id].asset=t)}))},loadNextPage(){},loadPageIndex(e,t){e.pageIndex=t.payload.pageIndex},orderSet(e,t){var n;e.order=null==(n=t.payload)?void 0:n.order,e.pageIndex=0},pick(e,t){const{assetId:n,picked:i}=t.payload;e.byIds[n].picked=i,e.lastPicked=i?n:void 0},pickAll(e){e.allIds.forEach((t=>{e.byIds[t].picked=!0}))},pickClear(e){e.lastPicked=void 0,Object.values(e.byIds).forEach((t=>{e.byIds[t.asset._id].picked=!1}))},pickRange(e,t){const n=e.allIds.findIndex((e=>e===t.payload.startId)),i=e.allIds.findIndex((e=>e===t.payload.endId)),a=[n,i].sort(((e,t)=>e-t));e.allIds.slice(a[0],a[1]+1).forEach((t=>{e.byIds[t].picked=!0})),e.lastPicked=e.allIds[i]},sort(e){e.allIds.sort(((t,n)=>{const i=e.byIds[t].asset[e.order.field],a=e.byIds[n].asset[e.order.field];return i<a?"asc"===e.order.direction?-1:1:i>a?"asc"===e.order.direction?1:-1:0}))},updateComplete(e,t){const{asset:n}=t.payload;e.byIds[n._id].updating=!1,e.byIds[n._id].asset=n},updateError(e,t){const{asset:n,error:i}=t.payload,a=null==n?void 0:n._id;e.byIds[a].error=i.message,e.byIds[a].updating=!1},updateRequest(e,t){var n,i;const a=null==(i=null==(n=t.payload)?void 0:n.asset)?void 0:i._id;e.byIds[a].updating=!0},viewSet(e,t){var n;e.view=null==(n=t.payload)?void 0:n.view}}}),si=_t([e=>e.assets.byIds,(e,t)=>t],((e,t)=>e[t])),di=_t([e=>e.assets.byIds,e=>e.assets.allIds],((e,t)=>t.map((t=>e[t])))),ci=_t([di],(e=>e.length)),ui=_t([di],(e=>e.filter((e=>null==e?void 0:e.picked)))),pi=_t([ui],(e=>e.length)),hi=ri.actions;var gi,mi,yi=ri.reducer;const fi=nn(m||(m=Y(["\n  ::-webkit-scrollbar {\n    width: 14px;\n  }\n\n  ::-webkit-scrollbar-thumb {\n    border-radius: 10px;\n    border: 4px solid rgba(0, 0, 0, 0);\n    background: ",";\n    background-clip: padding-box;\n\n    &:hover {\n      background: ",";\n      background-clip: padding-box;\n    }\n  }\n"])),null==(gi=Zt.gray)?void 0:gi[800].hex,null==(mi=Zt.gray)?void 0:mi[400].hex),vi=an(y||(y=Y(["\n  .media__custom-scrollbar {\n    ",'\n  }\n\n  // @sanity/ui overrides\n\n  // Custom scrollbar on Box (used in Dialogs)\n  div[data-ui="Box"] {\n    ','\n  }\n\n  // Dialog background color\n  div[data-ui="Dialog"] {\n    background-color: rgba(15, 17, 18, 0.9);\n  }\n\n'])),fi,fi),bi=Ct,xi=kt({name:"dialog",initialState:{items:[]},extraReducers:e=>{e.addCase(Hn.showTagCreate,(e=>{e.items.push({id:"tagCreate",type:"tagCreate"})})),e.addCase(Hn.showTagEdit,((e,t)=>{const{tagId:n}=t.payload;e.items.push({id:n,tagId:n,type:"tagEdit"})}))},reducers:{clear(e){e.items=[]},inlineTagCreate(e,t){const{assetId:n,tag:i}=t.payload;e.items.forEach((e=>{"assetEdit"===e.type&&e.assetId===n&&(e.lastCreatedTag={label:i.name.current,value:i._id})}))},inlineTagRemove(e,t){const{tagIds:n}=t.payload;e.items.forEach((e=>{"assetEdit"===e.type&&(e.lastRemovedTagIds=n)}))},remove(e,t){var n;const i=null==(n=t.payload)?void 0:n.id;e.items=e.items.filter((e=>e.id!==i))},showConfirmAssetsTagAdd(e,t){const{assetsPicked:n,closeDialogId:i,tag:a}=t.payload,l="".concat(n.length," ").concat(ln("asset",n.length));e.items.push({closeDialogId:i,confirmCallbackAction:Xn.tagsAddRequest({assets:n,tag:a}),confirmText:"Yes, add tag to ".concat(l),title:"Add tag ".concat(a.name.current," to ").concat(l,"?"),id:"confirm",headerTitle:"Confirm tag addition",tone:"primary",type:"confirm"})},showConfirmAssetsTagRemove(e,t){const{assetsPicked:n,closeDialogId:i,tag:a}=t.payload,l="".concat(n.length," ").concat(ln("asset",n.length));e.items.push({closeDialogId:i,confirmCallbackAction:Xn.tagsRemoveRequest({assets:n,tag:a}),confirmText:"Yes, remove tag from ".concat(l),headerTitle:"Confirm tag removal",id:"confirm",title:"Remove tag ".concat(a.name.current," from ").concat(l,"?"),tone:"critical",type:"confirm"})},showConfirmDeleteAssets(e,t){const{assets:n,closeDialogId:i}=t.payload,a="".concat(n.length," ").concat(ln("asset",n.length));e.items.push({closeDialogId:i,confirmCallbackAction:hi.deleteRequest({assets:n.map((e=>e.asset))}),confirmText:"Yes, delete ".concat(a),description:"This operation cannot be reversed. Are you sure you want to continue?",title:"Permanently delete ".concat(a,"?"),id:"confirm",headerTitle:"Confirm deletion",tone:"critical",type:"confirm"})},showConfirmDeleteTag(e,t){const{closeDialogId:n,tag:i}=t.payload;e.items.push({closeDialogId:n,confirmCallbackAction:Kn.deleteRequest({tag:i}),confirmText:"Yes, delete ".concat("tag"),description:"This operation cannot be reversed. Are you sure you want to continue?",title:"Permanently delete ".concat("tag","?"),id:"confirm",headerTitle:"Confirm deletion",tone:"critical",type:"confirm"})},showAssetEdit(e,t){const{assetId:n}=t.payload;e.items.push({assetId:n,id:n,type:"assetEdit"})},showSearchFacets(e){e.items.push({id:"searchFacets",type:"searchFacets"})},showTags(e){e.items.push({id:"tags",type:"tags"})}}}),Ci=xi.actions;var wi=xi.reducer;const Ii=()=>{const e=wt(),t=bi((e=>e.assets.view));return Se(Ee,{space:0,style:{whiteSpace:"nowrap"},children:[_e(ze,{fontSize:1,icon:te,mode:"grid"===t?"default":"ghost",onClick:()=>e(hi.viewSet({view:"grid"})),style:{borderBottomRightRadius:0,borderTopRightRadius:0}}),_e(ze,{fontSize:1,icon:ne,mode:"table"===t?"default":"ghost",onClick:()=>e(hi.viewSet({view:"table"})),style:{borderBottomLeftRadius:0,borderTopLeftRadius:0}})]})},Ti=()=>{var e;const t=wt(),n=bi((e=>e.assets.order));return _e(Ae,{button:_e(ze,{fontSize:1,icon:ie,iconRight:ae,mode:"ghost",padding:3,text:Mn(n.field,n.direction)}),id:"order",menu:_e(Oe,{children:null==(e=En)?void 0:e.map(((e,i)=>e?_e(De,{disabled:n.field===e.field&&n.direction===e.direction,fontSize:1,onClick:()=>t(hi.orderSet({order:{direction:e.direction,field:e.field}})),padding:2,text:Mn(e.field,e.direction)},i):_e(qe,{},i)))})})},ki=e=>{const{loading:t}=e,{animationDuration:n,isFinished:i,progress:a}=on({animationDuration:300,isAnimating:t});return _e(Le,{style:{opacity:i?0:1,transition:"opacity ".concat(n,"ms linear")},children:_e(Le,{style:{height:"1px",background:"rgba(255, 255, 255, 0.5)",position:"absolute",left:0,top:0,transition:"width ".concat(n,"ms linear"),width:"".concat(100*a,"%")}})})},_i=tn(Le)(f||(f=Y(["\n  background: rgba(255, 255, 255, 0.05);\n  border-radius: ","px;\n"])),(e=>e.theme.sanity.radius[2])),Si=e=>{const{children:t,facet:n}=e,i=wt();return _e(_i,{padding:[2,2,1],children:Se(je,{align:["flex-start","flex-start","center"],direction:["column","column","row"],children:[_e(Le,{paddingBottom:[3,3,0],paddingLeft:1,paddingRight:2,paddingTop:[1,1,0],children:_e(Fe,{size:0,style:{whiteSpace:"nowrap"},children:n.title})}),Se(je,{align:"center",children:[t,_e(Le,{marginLeft:1,paddingX:2,children:_e(Pe,{muted:!0,size:0,children:_e(le,{onClick:()=>{i(ni.facetsRemove({facetName:n.name}))}})})})]})]})})},Ri=t=>{const{onValueChange:n,value:i}=t,a=Q(t,e);return _e(Ue,X(X({},a),{},{onChange:e=>{const t=e.target.value;(""===t||/^[0-9\b]+$/.test(t))&&n(parseInt(t,10)||"")},value:null!=i?i:""}))},Ei=e=>{var t;const{facet:n}=e,i=wt(),a=null==n?void 0:n.modifiers,l=(null==n?void 0:n.modifier)?null==a?void 0:a.find((e=>e.name===(null==n?void 0:n.modifier))):null==a?void 0:a[0],o=null!=(t=n.operatorType)?t:"greaterThan";return Se(Si,{facet:n,children:[(null==n?void 0:n.operatorTypes)&&_e(Ae,{button:_e(ze,{fontSize:1,iconRight:ae,padding:2,text:Rn[o].label}),id:"operators",menu:_e(Oe,{children:n.operatorTypes.map(((e,t)=>e?_e(De,{disabled:e===o,fontSize:1,onClick:()=>(e=>{i(ni.facetsUpdate({name:n.name,operatorType:e}))})(e),padding:2,text:Rn[e].label},e):_e(qe,{},t)))})}),_e(Le,{marginX:1,style:{maxWidth:"50px"},children:_e(Ri,{fontSize:1,onValueChange:e=>{i(ni.facetsUpdate({name:n.name,value:e}))},padding:2,radius:2,width:2,value:null==n?void 0:n.value})}),a&&_e(Ae,{button:_e(ze,{fontSize:1,iconRight:ae,padding:2,text:null==l?void 0:l.title}),id:"modifier",menu:_e(Oe,{children:a.map((e=>_e(De,{disabled:e.name===n.modifier,fontSize:1,onClick:()=>(e=>{i(ni.facetsUpdate({name:n.name,modifier:e.name}))})(e),padding:2,text:e.title},e.name)))})})]})},zi=e=>{var t;const{facet:n}=e,i=wt(),a=null==n?void 0:n.options,l=null==a?void 0:a.find((e=>e.name===(null==n?void 0:n.value))),o=null!=(t=null==n?void 0:n.operatorType)?t:"is";return Se(Si,{facet:n,children:[(null==n?void 0:n.operatorTypes)&&_e(Ae,{button:_e(ze,{fontSize:1,iconRight:ae,padding:2,style:{marginRight:"4px"},text:Rn[o].label}),id:"operators",menu:_e(Oe,{children:n.operatorTypes.map(((e,t)=>e?_e(De,{disabled:e===o,fontSize:1,onClick:()=>(e=>{i(ni.facetsUpdate({name:n.name,operatorType:e}))})(e),padding:2,text:Rn[e].label},e):_e(qe,{},t)))})}),_e(Ae,{button:_e(ze,{fontSize:1,iconRight:ae,padding:2,text:null==l?void 0:l.title}),id:"list",menu:_e(Oe,{children:null==a?void 0:a.map(((e,t)=>_e(De,{disabled:e.name===(null==l?void 0:l.name),fontSize:1,onClick:()=>{return e=a[t],void i(ni.facetsUpdate({name:n.name,value:e.name}));var e},padding:2,text:e.title},e.name)))})})]})},Ai=e=>{const{facet:t}=e,n=wt(),i=t.operatorType;return Se(Si,{facet:t,children:[(null==t?void 0:t.operatorTypes)&&_e(Ae,{button:_e(ze,{fontSize:1,iconRight:ae,padding:2,text:Rn[i].label}),id:"operators",menu:_e(Oe,{children:t.operatorTypes.map(((e,a)=>e?_e(De,{disabled:e===i,fontSize:1,onClick:()=>(e=>{n(ni.facetsUpdate({name:t.name,operatorType:e}))})(e),padding:2,text:Rn[e].label},e):_e(qe,{},a)))})}),!Rn[i].hideInput&&_e(Le,{marginLeft:1,style:{maxWidth:"125px"},children:_e(Ue,{fontSize:1,onChange:e=>{n(ni.facetsUpdate({name:t.name,value:e.target.value}))},padding:2,radius:2,width:2,value:null==t?void 0:t.value})})]})};var Oi,Di,qi,Li,ji,Fi,Pi,Ui,Mi,Ni,Vi,Qi,Bi,Xi,Hi;const Yi=null==(ji=null==(Li=null==(qi=null==(Di=null==(Oi=Me)?void 0:Oi.color)?void 0:Di.dark)?void 0:qi.primary)?void 0:Li.spot)?void 0:ji.blue,$i=null==(Ni=null==(Mi=null==(Ui=null==(Pi=null==(Fi=Me)?void 0:Fi.color)?void 0:Pi.dark)?void 0:Ui.default)?void 0:Mi.base)?void 0:Ni.bg,Wi=null==(Vi=Me)?void 0:Vi.radius,Gi=null==(Qi=Me)?void 0:Qi.space,Ki=null==(Hi=null==(Xi=null==(Bi=Me)?void 0:Bi.fonts)?void 0:Xi.text)?void 0:Hi.sizes,Zi={control:(e,t)=>{let{isDisabled:n,isFocused:i}=t,a="inset 0 0 0 1px ".concat(Zt.gray[900].hex);return i&&(a="inset 0 0 0 1px ".concat(Zt.gray[900].hex,", 0 0 0 1px var(--card-bg-color), 0 0 0 3px var(--card-focus-ring-color) !important")),X(X({},e),{},{backgroundColor:$i,color:Jt.hex,border:"none",borderRadius:Wi[2],boxShadow:a,fontSize:Ki[1].fontSize,minHeight:"25px",opacity:n?.5:"inherit",outline:"none",transition:"none","&:hover":{boxShadow:"inset 0 0 0 1px ".concat(Me.color.dark.default.input.default.hovered.border)}})},input:e=>X(X({},e),{},{color:Jt.hex,fontFamily:Me.fonts.text.family,marginLeft:Gi[2]}),menuList:e=>X(X({},e),{},{padding:0}),noOptionsMessage:e=>X(X({},e),{},{fontFamily:Me.fonts.text.family,fontSize:Ki[1].fontSize,lineHeight:"1em"}),option:(e,t)=>{let{isFocused:n}=t;return X(X({},e),{},{backgroundColor:n?Yi:"transparent",borderRadius:Wi[2],color:n?en.hex:"inherit",fontSize:Ki[1].fontSize,lineHeight:"1em",padding:"4px 6px","&:hover":{backgroundColor:Yi,color:en.hex}})},placeholder:e=>X(X({},e),{},{fontFamily:Me.fonts.text.family,marginLeft:Gi[2],paddingBottom:"2px"}),singleValue:e=>X(X({},e),{},{color:Jt.hex,lineHeight:"1em",paddingBottom:"1px"}),valueContainer:e=>X(X({},e),{},{margin:0,padding:0})},Ji=e=>_e(Le,{padding:1,children:_e(sn.Option,X(X({},e),{},{children:_e(Le,{paddingY:1,children:_e(Pe,{size:1,style:{color:"inherit"},textOverflow:"ellipsis",children:e.children})})}))}),ea={ClearIndicator:e=>_e(sn.ClearIndicator,X(X({},e),{},{children:_e(Le,{paddingRight:1,style:{transform:"scale(0.85)"},children:_e(Pe,{muted:!0,size:0,children:_e(le,{})})})})),DropdownIndicator:null,IndicatorSeparator:null,Menu:e=>_e(sn.Menu,X(X({},e),{},{children:_e(Ne,{radius:1,shadow:2,children:e.children})})),MenuList:e=>{const{children:t}=e;if(Array.isArray(t)){const e=t.length>5?165:33*t.length;return _e(dn,{className:"media__custom-scrollbar",itemContent:e=>{const n=t[e];return _e(Ji,X({},n.props))},style:{height:e},totalCount:t.length})}return _e(sn.MenuList,X(X({},e),{},{children:t}))},NoOptionsMessage:e=>_e(sn.NoOptionsMessage,X(X({},e),{},{children:e.children})),Option:Ji,SingleValue:e=>_e(sn.SingleValue,X(X({},e),{},{children:_e(Le,{paddingLeft:2,children:_e(Pe,{size:1,style:{color:"inherit",lineHeight:"2em"},textOverflow:"ellipsis",children:e.children})})}))},ta=e=>{const{facet:t}=e,n=wt(),i=bi((e=>Wn(e))),a=bi((e=>e.tags.fetching)),l=Bn(i),o=t.operatorType;return Se(Si,{facet:t,children:[(null==t?void 0:t.operatorTypes)&&_e(Ae,{button:_e(ze,{fontSize:1,iconRight:ae,padding:2,text:Rn[o].label}),id:"operators",menu:_e(Oe,{children:t.operatorTypes.map(((e,i)=>e?_e(De,{disabled:e===o,fontSize:1,onClick:()=>(e=>{n(ni.facetsUpdate({name:t.name,operatorType:e}))})(e),padding:2,text:Rn[e].label},e):_e(qe,{},i)))})}),!Rn[o].hideInput&&_e(Le,{marginX:1,style:{width:"160px"},children:_e(rn,{components:ea,instanceId:"facet-searchable",isClearable:!0,isDisabled:a,isSearchable:!0,name:"tags",noOptionsMessage:()=>"No tags",onChange:e=>{return i=e,void n(ni.facetsUpdate({name:t.name,value:i}));var i},options:l,placeholder:a?"Loading...":"Select...",styles:Zi,value:null==t?void 0:t.value})})]})},na=tn(je)(v||(v=Y(["\n  > * {\n    margin-bottom: ","px;\n  }\n"])),(e=>e.theme.sanity.space[2])),ia=e=>{const{layout:t="inline"}=e,n=bi((e=>e.search.facets)),i=n.map((e=>"number"===e.type?_e(Ei,{facet:e},e.name):"searchable"===e.type?_e(ta,{facet:e},e.name):"select"===e.type?_e(zi,{facet:e},e.name):"string"===e.type?_e(Ai,{facet:e},e.name):null));if("inline"===t)return 0===n.length?null:_e(Le,{marginBottom:2,children:_e(Ee,{space:2,children:i})});if("stack"===t)return _e(na,{align:"flex-start",direction:"column",children:i});throw Error("Invalid layout")},aa=()=>{const e=wt(),t=bi((e=>e.assets.assetTypes)),n=bi((e=>e.search.facets)),i=!bi((e=>e.selected.document)),a=zn.filter((e=>{if("group"===e.type||"divider"===e.type)return!0;if(i)return!(null==e?void 0:e.selectOnly);return e.assetTypes.filter((e=>t.includes(e))).length>0})).filter(((e,t,n)=>{const i=n[t-1];return("divider"!==e.type||0!==t&&t!==n.length-1)&&("divider"!==e.type||"divider"!==(null==i?void 0:i.type))})),l=a.filter((e=>e)).length-n.length>0,o=function(t){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return _e(Re,{children:null==t?void 0:t.map(((t,a)=>{if("divider"===t.type)return _e(qe,{},a);if("group"===t.type)return _e(Ve,{text:t.title,title:t.title,children:o(t.facets,i+1)},"group-".concat(i,"-").concat(a));if(t){const i=!!n.find((e=>e.name===t.name));return _e(De,{disabled:i,fontSize:1,onClick:()=>e(ni.facetsAdd({facet:t})),padding:2,text:t.title},t.name)}return null}))})};return Se(je,{children:[_e(Ae,{button:_e(ze,{disabled:!l,fontSize:1,icon:oe,mode:"bleed",text:"Add filter",tone:"primary"}),id:"facets",menu:_e(Oe,{children:o(a)}),placement:"right-start",portal:!0}),n.length>0&&_e(ze,{fontSize:1,mode:"bleed",onClick:()=>e(ni.facetsClear()),text:"Clear"})]})},la=()=>Se("svg",{"data-sanity-icon":"media__tag",fill:"currentColor",height:"1em",stroke:"currentColor",strokeWidth:"0",viewBox:"0 0 512 512",width:"1em",children:[_e("path",{d:"M435.25 48h-122.9a14.46 14.46 0 00-10.2 4.2L56.45 297.9a28.85 28.85 0 000 40.7l117 117a28.85 28.85 0 0040.7 0L459.75 210a14.46 14.46 0 004.2-10.2v-123a28.66 28.66 0 00-28.7-28.8z",fill:"none",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"32"}),_e("path",{d:"M384 160a32 32 0 1132-32 32 32 0 01-32 32z"})]}),oa=()=>{const e=bi((e=>e.search.query)),t=wt();return Se(Le,{style:{position:"relative"},children:[_e(Ue,{fontSize:1,icon:re,onChange:e=>{t(ni.querySet({searchQuery:e.currentTarget.value}))},placeholder:"Search",radius:2,value:e}),e.length>0&&_e(je,{align:"center",justify:"center",onClick:()=>{t(ni.querySet({searchQuery:""}))},style:{cursor:"pointer",height:"100%",opacity:.75,position:"absolute",right:0,top:0,width:"2em",zIndex:1},children:_e(le,{})})]})},ra=()=>{var e;const t=wt(),n=bi((e=>e.assets.fetching)),i=bi((e=>e.assets.pageIndex)),a=bi((e=>e.search.facets)),l=bi((e=>e.tags.panelVisible)),o=Qe();return Se(Le,{paddingY:2,style:{borderBottom:"1px solid ".concat(null==(e=Zt.gray)?void 0:e[900].hex),zIndex:2},children:[_e(Le,{marginBottom:2,children:_e(je,{align:"flex-start",direction:["column","column","column","column","row"],justify:"space-between",children:Se(je,{flex:1,style:{alignItems:"flex-start",flex:1,height:"100%",justifyContent:o<2?"space-between":"flex-start",position:"relative",width:"100%"},children:[_e(Le,{marginX:2,style:{minWidth:"200px"},children:_e(oa,{})}),Se(Le,{display:["none","none","block"],children:[_e(ia,{}),_e(aa,{})]}),_e(Le,{display:["block","block","none"],marginX:2,children:Se(Ee,{space:2,style:{whiteSpace:"nowrap"},children:[_e(ze,{fontSize:1,mode:"ghost",onClick:()=>{t(Ci.showSearchFacets())},text:"Filters".concat(a.length>0?" (".concat(a.length,")"):""),tone:"primary"}),_e(ze,{fontSize:1,mode:"ghost",onClick:()=>{t(Ci.showTags())},text:"Tags",tone:"primary"})]})})]})})}),_e(Le,{children:Se(je,{align:"center",justify:["space-between"],children:[_e(Le,{marginX:2,children:_e(Ii,{})}),Se(je,{marginX:2,children:[_e(Ti,{}),_e(Le,{display:["none","none","block"],marginLeft:2,children:_e(ze,{fontSize:1,icon:_e(Le,{style:{transform:"scale(0.75)"},children:_e(la,{})}),onClick:()=>{t(Kn.panelVisibleSet({panelVisible:!l}))},mode:l?"default":"ghost",text:l?"Tags":""})})]})]})}),_e(ki,{loading:n},i)]})},sa=kt({name:"debug",initialState:{badConnection:!1,enabled:!1},reducers:{setBadConnection(e,t){e.badConnection=t.payload},toggleEnabled(e){e.enabled=!e.enabled}}}),da=sa.actions;var ca=sa.reducer;const ua=()=>{const e=wt(),t=bi((e=>e.debug.badConnection)),n=bi((e=>e.debug.enabled));return kn("alt+ctrl+shift+/",(()=>{e(da.toggleEnabled())})),n?_e(Le,{padding:4,style:{bottom:0,left:0,pointerEvents:"none",position:"fixed",width:"100%"},children:Se(je,{align:"center",children:[_e(Le,{marginRight:3,children:_e(Pe,{muted:!0,size:1,children:_e(se,{})})}),_e(Be,{content:_e(Le,{padding:2,children:_e(Pe,{muted:!0,size:1,children:t?"Bad connection: +3000ms & 50% chance to fail":"No connection throttling"})}),fallbackPlacements:["right","left"],placement:"bottom",children:_e(Xe,{checked:t,onChange:t=>{const n=t.target.checked;e(da.setBadConnection(n))},style:{pointerEvents:"auto"}})})]})}):null},pa=(e,t)=>{const n="undefined"!=typeof window&&window.devicePixelRatio?Math.round(window.devicePixelRatio):1,i=(null==t?void 0:t.height)?(null==t?void 0:t.height)*Math.max(1,n):void 0,a=t.width*Math.max(1,n),l=new URLSearchParams;return l.append("fit","max"),l.append("w",a.toString()),i&&l.append("h",i.toString()),"".concat(e.url,"?").concat(l.toString())},ha=e=>Object.keys(e).reduce(((t,n)=>{const i=e[n];return"object"==typeof i&&null!==i&&i.constructor!==Array?t[n]=ha(i):""===i||void 0===i||0===(null==i?void 0:i.length)?t[n]=null:t[n]="string"==typeof i&&i?e[n].trim():e[n],t}),{}),ga=e=>"sanity.fileAsset"===e._type,ma=e=>"sanity.imageAsset"===e._type,ya=e=>"".concat(e.metadata.dimensions.width,"x").concat(e.metadata.dimensions.height,"px"),fa=e=>{const{disabled:t,url:n}=e,i=ct(),[a,l]=gt(!1);return ut((()=>()=>{i.current&&clearTimeout(i.current)}),[]),_e(He,{content:_e(Pe,{muted:!0,size:1,children:"Copied!"}),open:a,padding:2,placement:"top",radius:1,children:_e(ze,{disabled:t,fontSize:1,icon:de,mode:"ghost",onClick:()=>{i.current&&clearTimeout(i.current),l(!0),vn(n),i.current=setTimeout((()=>{l(!1)}),1250)},text:"Copy URL"})})},va=e=>{let{label:t,value:n}=e;return Se(je,{justify:"space-between",children:[_e(Pe,{size:1,style:{opacity:.8,width:"40%"},textOverflow:"ellipsis",children:t}),_e(Pe,{size:1,style:{opacity:.4,textAlign:"right",width:"60%"},textOverflow:"ellipsis",children:n})]})},ba=e=>{var t;const{asset:n,item:i}=e,a=null==(t=null==n?void 0:n.metadata)?void 0:t.exif;return Se(Le,{marginTop:3,children:[_e(Le,{children:Se(Ye,{space:3,children:[_e(va,{label:"Size",value:fn(null==n?void 0:n.size,{base:10,round:0})}),_e(va,{label:"MIME type",value:null==n?void 0:n.mimeType}),_e(va,{label:"Extension",value:(null==n?void 0:n.extension).toUpperCase()}),ma(n)&&_e(va,{label:"Dimensions",value:ya(n)})]})}),a&&Se(Re,{children:[_e(Le,{marginY:4,style:{background:"#222",height:"1px",width:"100%"}}),_e(Le,{children:Se(Ye,{space:3,children:[a.ISO&&_e(va,{label:"ISO",value:a.ISO}),a.FNumber&&_e(va,{label:"Aperture",value:"ƒ/".concat(a.FNumber)}),a.FocalLength&&_e(va,{label:"Focal length",value:"".concat(a.FocalLength,"mm")}),a.ExposureTime&&_e(va,{label:"Exposure time",value:"1/".concat(1/a.ExposureTime)}),a.DateTimeOriginal&&_e(va,{label:"Original date",value:yn(new Date(a.DateTimeOriginal),"PPp")})]})})]}),_e(Le,{marginTop:5,children:Se(Ee,{space:2,children:[_e(ze,{disabled:!i||(null==i?void 0:i.updating),fontSize:1,icon:ce,mode:"ghost",onClick:()=>{window.location.href="".concat(n.url,"?dl=").concat(n.originalFilename)},text:"Download"}),_e(fa,{disabled:!i||(null==i?void 0:i.updating),url:n.url})]})})]})},xa=e=>_e($e,X(X({},e),{},{style:{position:"fixed"}})),Ca=e=>{const{assetId:t}=e,n=W();return _e(G,{documentStore:n,id:t,children:e=>{let{isLoading:t,referringDocuments:n}=e;return _e(wa,{isLoading:t,referringDocuments:n})}})},wa=e=>{const{isLoading:t,referringDocuments:n}=e,i=K(),a=n.reduce(((e,t)=>t._id.startsWith("drafts.")?e.concat(t._id.slice(7)):e),[]),l=n.filter((e=>!a.includes(e._id)));return t?_e(Pe,{size:1,children:"Loading..."}):0===l.length?_e(Pe,{size:1,children:"No documents are referencing this asset"}):_e(Ne,{flex:1,marginBottom:2,padding:2,radius:2,shadow:1,children:_e(Ye,{space:2,children:null==l?void 0:l.map((e=>_e(Ia,{doc:e,schemaType:i.get(e._type)},e._id)))})})},Ia=e=>{const{doc:t,schemaType:n}=e,{onClick:i}=bn({intent:"edit",params:{id:t._id}});return n?_e(ze,{mode:"bleed",onClick:i,padding:2,style:{width:"100%"},children:_e(Z,{layout:"default",schemaType:n,value:t})},t._id):_e(Le,{padding:2,children:Se(Pe,{size:1,children:["A document of the unknown type ",_e("em",{children:t._type})]})})},Ta=tn(Le)(b||(b=Y(["\n  text {\n    font-family: "," !important;\n    font-size: 8px !important;\n    font-weight: 500 !important;\n  }\n"])),(e=>e.theme.sanity.fonts.text.family)),ka=e=>{const{extension:t,onClick:n,width:i}=e;return _e(je,{align:"center",justify:"center",onClick:n,style:{height:"100%"},children:_e(Ta,{style:{width:i},children:_e(xn,t?X({extension:t},Cn[t]):{})})})},_a=e=>{const{asset:t}=e;return 0===t.mimeType.search("audio")?_e(je,{align:"center",justify:"center",style:{height:"100%"},children:_e("audio",{controls:!0,src:t.url,style:{width:"100%"}})}):0===t.mimeType.search("video")?_e("video",{controls:!0,src:t.url,style:{height:"100%",width:"100%"}}):_e(ka,{extension:t.extension,width:"50%"})};var Sa,Ra,Ea,za,Aa,Oa,Da,qa,La,ja,Fa,Pa;const Ua=null==(Aa=null==(za=null==(Ea=null==(Ra=null==(Sa=Me)?void 0:Sa.color)?void 0:Ra.dark)?void 0:Ea.primary)?void 0:za.spot)?void 0:Aa.blue,Ma=null==(ja=null==(La=null==(qa=null==(Da=null==(Oa=Me)?void 0:Oa.color)?void 0:Da.dark)?void 0:qa.primary)?void 0:La.spot)?void 0:ja.gray,Na=null==(Fa=Me)?void 0:Fa.radius,Va=null==(Pa=Me)?void 0:Pa.space,Qa={control:(e,t)=>{let{isDisabled:n,isFocused:i}=t,a="inset 0 0 0 1px ".concat(Zt.gray[900].hex);return i&&(a="inset 0 0 0 1px ".concat(Zt.gray[900].hex,", 0 0 0 1px var(--card-bg-color), 0 0 0 3px var(--card-focus-ring-color) !important")),X(X({},e),{},{background:n?Me.color.dark.default.input.default.disabled.bg:"transparent",color:Jt.hex,border:"none",borderRadius:Na[1],boxShadow:a,minHeight:"35px",outline:"none",transition:"none","&:hover":{boxShadow:"inset 0 0 0 1px ".concat(Me.color.dark.default.input.default.hovered.border)}})},indicatorsContainer:(e,t)=>{let{isDisabled:n}=t;return X(X({},e),{},{opacity:n?.25:1})},input:e=>X(X({},e),{},{color:Jt.hex,fontFamily:Me.fonts.text.family,marginLeft:Va[2]}),menuList:e=>X({},e),multiValue:(e,t)=>{let{isDisabled:n}=t;return X(X({},e),{},{backgroundColor:Ma,borderRadius:Na[2],opacity:n?.5:1})},multiValueRemove:e=>X(X({},e),{},{paddingLeft:0,"&:hover":{background:"transparent",color:"inherit"}}),noOptionsMessage:e=>X(X({},e),{},{fontFamily:Me.fonts.text.family,lineHeight:"1em"}),option:(e,t)=>{let{isFocused:n}=t;return X(X({},e),{},{backgroundColor:n?Ua:"transparent",borderRadius:Na[2],color:n?en.hex:"inherit",fontFamily:Me.fonts.text.family,padding:"4px 8px","&:hover":{backgroundColor:Ua,color:en.hex}})},placeholder:e=>X(X({},e),{},{fontFamily:Me.fonts.text.family,marginLeft:Va[2]}),valueContainer:e=>X(X({},e),{},{marginBottom:Va[0],marginLeft:Va[1],marginTop:Va[0],padding:0})},Ba=e=>_e(Le,{paddingX:1,paddingY:1,children:_e(sn.Option,X(X({},e),{},{children:Se(je,{align:"center",children:[e.data.__isNew__&&_e(pe,{style:{marginRight:"3px"}}),e.children]})}))}),Xa={DropdownIndicator:e=>_e(sn.DropdownIndicator,X(X({},e),{},{children:_e(Le,{paddingX:2,children:_e(Pe,{size:1,children:_e(ue,{})})})})),IndicatorSeparator:null,Menu:e=>_e(sn.Menu,X(X({},e),{},{children:_e(Ne,{radius:1,shadow:2,children:e.children})})),MenuList:e=>{const{children:t}=e;if(Array.isArray(t)){const e=t.length>5?185:37*t.length;return _e(dn,{className:"media__custom-scrollbar",itemContent:e=>{const n=t[e];return _e(Ba,X({},n.props))},style:{height:e},totalCount:t.length})}return _e(sn.MenuList,X(X({},e),{},{children:t}))},MultiValueLabel:e=>_e(Le,{paddingLeft:1,paddingRight:0,paddingY:1,children:_e(Pe,{size:2,weight:"medium",children:_e(sn.MultiValueLabel,X({},e))})}),MultiValueRemove:e=>_e(sn.MultiValueRemove,X(X({},e),{},{children:_e(le,{color:"#1f2123"})})),Option:Ba},Ha=tn(he)((e=>{let{theme:t}=e;return{color:t.sanity.color.spot.red}})),Ya=e=>{const{description:t,error:n,label:i,name:a}=e;return Se(Re,{children:[_e(Le,{marginY:3,children:Se(Ee,{space:2,children:[_e(Pe,{as:"label",htmlFor:a,size:1,weight:"semibold",children:i}),n&&_e(Pe,{size:1,children:_e(Be,{content:_e(Le,{padding:2,children:Se(Pe,{muted:!0,size:1,children:[_e(Ha,{style:{marginRight:"0.1em"}}),n.message]})}),fallbackPlacements:["top","left"],placement:"right",portal:!0,children:_e(Ha,{})})})]})}),t&&_e(Le,{marginY:3,children:_e(Pe,{htmlFor:a,muted:!0,size:1,children:t})})]})},$a=e=>{const{control:t,description:n,disabled:i,error:a,label:l,name:o,onCreateTag:r,options:s,placeholder:d,value:c}=e,u=bi((e=>e.tags.creating)),p=bi((e=>e.tags.fetching));return Se(Le,{style:{zIndex:2},children:[_e(Ya,{description:n,error:a,label:l,name:o}),_e(hn,{control:t,defaultValue:c,name:o,render:e=>{let{onBlur:t,onChange:n,value:a}=e;return _e(wn,{components:Xa,instanceId:"tags",isClearable:!1,isDisabled:u||i||p,isLoading:u,isMulti:!0,name:o,noOptionsMessage:()=>"No tags",onBlur:t,onChange:n,onCreateOption:r,options:s,placeholder:p?"Loading...":d,styles:Qa,value:a})}})]})},Wa=mt(((e,t)=>{const{description:n,disabled:i,error:a,type:l,label:o,name:r,placeholder:s,value:d,onChange:c}=e;return Se(Le,{children:[_e(Ya,{description:n,error:a,label:o,name:r}),_e(Ue,{autoComplete:"off",autoFocus:!0,defaultValue:d,disabled:i,id:r,onChange:c,type:l,name:r,placeholder:s,ref:t})]})})),Ga=mt(((e,t)=>{const{description:n,disabled:i,error:a,label:l,name:o,placeholder:r,rows:s,value:d}=e;return Se(Le,{children:[_e(Ya,{description:n,error:a,label:l,name:o}),_e(We,{autoComplete:"off",defaultValue:d,disabled:i,id:o,name:o,placeholder:r,ref:t,rows:s})]})})),Ka=e=>{const{disabled:t,isValid:n,lastUpdated:i,onClick:a}=e;let l;return l=n?i?Se(Re,{children:["Last updated",_e("br",{})," ",yn(new Date(i),"PPp")]}):"No unpublished changes":"There are validation errors that need to be fixed before this document can be published",_e(Be,{content:_e(Le,{padding:3,style:{maxWidth:"185px"},children:_e(Pe,{muted:!0,size:1,children:l})}),disabled:"ontouchstart"in window,placement:"top",children:_e(Le,{children:_e(ze,{disabled:t,fontSize:1,onClick:a,text:"Save and close",tone:"primary"})})})},Za=tn.img(x||(x=Y(["\n  --checkerboard-color: ",";\n\n  display: block;\n  width: 100%;\n  height: 100%;\n  object-fit: contain;\n\n  ","\n"])),Zt.gray[900].hex,(e=>e.showCheckerboard&&nn(C||(C=Y(["\n      background-image: linear-gradient(45deg, var(--checkerboard-color) 25%, transparent 25%),\n        linear-gradient(-45deg, var(--checkerboard-color) 25%, transparent 25%),\n        linear-gradient(45deg, transparent 75%, var(--checkerboard-color) 75%),\n        linear-gradient(-45deg, transparent 75%, var(--checkerboard-color) 75%);\n      background-size: 20px 20px;\n      background-position: 0 0, 0 10px, 10px -10px, -10px 0;\n    "]))))),Ja=mn.object().shape({originalFilename:mn.string().trim().required("Filename cannot be empty")}),el=e=>{var t,n,i,a;const{children:l,dialog:{assetId:o,id:r,lastCreatedTag:s,lastRemovedTagIds:d}}=e,c=Pn(),u=wt(),p=bi((e=>si(e,String(o)))),h=bi(Wn),g=ct(!1),[m,y]=gt(null==p?void 0:p.asset),[f,v]=gt("details"),[b,x]=gt([]),C=p?null==p?void 0:p.asset:m,T=Bn(h),k=bi((_=C,e=>{var t,n,i;const a=null==(i=null==(n=null==(t=null==_?void 0:_.opt)?void 0:t.media)?void 0:n.tags)?void 0:i.reduce(((t,n)=>{const i=e.tags.byIds[n._ref];return(null==i?void 0:i.tag)&&t.push(i),t}),[]);return a&&(null==a?void 0:a.length)>0?Bn(a):null}));var _;gt((null==C?void 0:C.isLicensed)||!1);const S=e=>({altText:(null==e?void 0:e.altText)||"",description:(null==e?void 0:e.description)||"",originalFilename:(null==e?void 0:e.originalFilename)||"",opt:{media:{tags:k}},title:(null==e?void 0:e.title)||""}),R=null==k?void 0:k.map((e=>e.label)).join(","),{control:E,formState:{errors:z,isDirty:A,isValid:O},getValues:D,handleSubmit:q,register:L,reset:j,setValue:F}=gn({defaultValues:S(null==p?void 0:p.asset),mode:"onChange",resolver:pn(Ja)}),P=!p||(null==p?void 0:p.updating),U=()=>{(null==p?void 0:p.asset)&&u(Ci.showConfirmDeleteAssets({assets:[p],closeDialogId:null==p?void 0:p.asset._id}))},M=e=>{const{result:t,transition:n}=e;t&&"update"===n&&(y(t),j(S(t)))},N=async e=>{var t;if(!(null==p?void 0:p.asset))return;const n=ha(e),i={asset:null==p?void 0:p.asset,closeDialogId:null==p?void 0:p.asset._id,formData:X(X({},n),{},{opt:{media:X(X({},n.opt.media),{},{tags:(null==(t=n.opt.media.tags)?void 0:t.map((e=>({_ref:e.value,_type:"reference",_weak:!0}))))||null})}})};console.log("payload is",i),u(hi.updateRequest(i))};ut((()=>{if(!(null==p?void 0:p.asset))return;const e=c.listen(xt(w||(w=Y(["*[_id == $id]"]))),{id:null==p?void 0:p.asset._id}).subscribe(M);return()=>{null==e||e.unsubscribe()}}),[]),ut((()=>{g.current&&j({opt:{media:{tags:k}}},{errors:!0,dirtyFields:!0,isDirty:!0}),g.current=!0}),[R]),ut((()=>{if(s){const e=(D("opt.media.tags")||[]).concat([s]);F("opt.media.tags",e,{shouldDirty:!0})}}),[s]),ut((()=>{if(d){const e=(D("opt.media.tags")||[]).filter((e=>!d.includes(e.value)));F("opt.media.tags",e,{shouldDirty:!0})}}),[d]),ut((()=>{(async()=>{const e=xt(I||(I=Y(['*[_type == "resort"]{_id, title, "gallery" : gallery.images[0]  }']))),t=(await c.fetch(e)).map((e=>{var t,n;return{value:null==e?void 0:e._id,label:null==e?void 0:e.title,image:(null==(t=null==e?void 0:e.gallery)?void 0:t.asset)?pa(null==(n=null==e?void 0:e.gallery)?void 0:n.asset,{height:50,width:50}):""}}));x(t)})()}),[]);return C?Se(xa,{footer:_e((()=>_e(Le,{padding:3,children:Se(je,{justify:"space-between",children:[_e(ze,{disabled:P,fontSize:1,mode:"bleed",onClick:U,text:"Delete",tone:"critical"}),_e(Ka,{disabled:P||!A||!O,isValid:O,lastUpdated:C._updatedAt,onClick:q(N)})]})})),{}),header:"Asset details",id:r,onClose:()=>{u(Ci.remove({id:r}))},width:3,children:[Se(je,{direction:["column-reverse","column-reverse","row-reverse"],children:[Se(Le,{flex:1,marginTop:[5,5,0],padding:4,children:[Se(Ge,{space:2,children:[_e(Ke,{"aria-controls":"details-panel",disabled:P,id:"details-tab",label:"Details",onClick:()=>v("details"),selected:"details"===f,size:2}),_e(Ke,{"aria-controls":"references-panel",disabled:P,id:"references-tab",label:"References",onClick:()=>v("references"),selected:"references"===f,size:2})]}),Se(Le,{as:"form",marginTop:4,onSubmit:q(N),children:[!p&&_e(Ne,{marginBottom:3,padding:3,radius:2,shadow:1,tone:"critical",children:_e(Pe,{size:1,children:"This file cannot be found – it may have been deleted."})}),_e("button",{style:{display:"none"},tabIndex:-1,type:"submit"}),_e(Ze,{"aria-labelledby":"details",hidden:"details"!==f,id:"details-panel",children:Se(Ye,{space:3,children:[_e($a,{control:E,disabled:P,error:null==(n=null==(t=null==z?void 0:z.opt)?void 0:t.media)?void 0:n.tags,label:"Tags",name:"opt.media.tags",onCreateTag:e=>{u(Kn.createRequest({assetId:null==C?void 0:C._id,name:e}))},options:T,placeholder:"Select or create...",value:k}),_e(Wa,{disabled:P,error:null==z?void 0:z.originalFilename,label:"Filename",name:"originalFilename",ref:L,value:null==C?void 0:C.originalFilename}),_e(Wa,{disabled:P,error:null==z?void 0:z.title,label:"Title",name:"title",ref:L,value:null==C?void 0:C.title}),_e(Wa,{disabled:P,error:null==z?void 0:z.altText,label:"Alt Text",name:"altText",ref:L,value:null==C?void 0:C.altText}),_e(Ga,{disabled:P,error:null==z?void 0:z.description,label:"Description",name:"description",ref:L,rows:3,value:null==C?void 0:C.description}),_e(Ne,{padding:4,children:Se(Ye,{children:[_e("label",{htmlFor:"isLicensed",children:"Photo licensed ?"}),Se(Je,{ref:L,id:"isLicensed",name:"isLicensed",defaultValue:null!=(i=null==C?void 0:C.isLicensed)?i:"no",children:[_e("option",{value:"yes",children:"Yes"}),_e("option",{value:"no",children:"No"})]})]})}),_e(Wa,{disabled:P,error:null==z?void 0:z.altText,label:"Renew Date",name:"renewDate",type:"date",ref:L,value:null==C?void 0:C.renewDate}),_e(Ne,{padding:4,children:Se(Ye,{children:[_e("label",{htmlFor:"resortRef",children:"Resort"}),_e(rn,{name:"resortRef",id:"resortRef",value:null==C?void 0:C.resortRef,ref:L,options:b,formatOptionLabel:e=>Se("div",{children:[(null==e?void 0:e.image)&&_e(Za,{src:null==e?void 0:e.image,alt:"resort-image"}),_e("span",{children:null==e?void 0:e.label})]})})]})})]})}),_e(Ze,{"aria-labelledby":"references",hidden:"references"!==f,id:"references-panel",children:_e(Le,{marginTop:5,children:(null==p?void 0:p.asset)&&_e(Ca,{assetId:null==p?void 0:p.asset._id})})})]})]}),Se(Le,{flex:1,padding:4,children:[Se(Le,{style:{aspectRatio:"1"},children:[ga(C)&&_e(_a,{asset:C}),ma(C)&&_e(Za,{draggable:!1,showCheckerboard:!(null==(a=null==C?void 0:C.metadata)?void 0:a.isOpaque),src:pa(C,{height:600,width:600})})]}),C&&_e(Le,{marginTop:4,children:_e(ba,{asset:C,item:p})})]})]}),l]}):null},tl=e=>{const{children:t,dialog:n}=e,i=wt(),a=()=>{i(Ci.remove({id:null==n?void 0:n.id}))},l=()=>{(null==n?void 0:n.closeDialogId)&&i(Ci.remove({id:null==n?void 0:n.closeDialogId})),(null==n?void 0:n.confirmCallbackAction)&&i(n.confirmCallbackAction),a()},o=()=>Se(je,{align:"center",children:[_e(Le,{paddingX:1,children:_e(ge,{})}),_e(Le,{marginLeft:2,children:null==n?void 0:n.headerTitle})]});return Se(xa,{footer:_e((()=>_e(Le,{padding:3,children:Se(je,{justify:"space-between",children:[_e(ze,{fontSize:1,mode:"bleed",onClick:a,text:"Cancel"}),_e(ze,{fontSize:1,onClick:l,text:null==n?void 0:n.confirmText,tone:null==n?void 0:n.tone})]})})),{}),header:_e(o,{}),id:"confirm",onClose:a,width:1,children:[_e(Le,{paddingX:4,paddingY:4,children:Se(Ye,{space:3,children:[(null==n?void 0:n.title)&&_e(Pe,{size:1,children:n.title}),(null==n?void 0:n.description)&&_e(Pe,{muted:!0,size:1,children:_e("em",{children:n.description})})]})}),t]})},nl=e=>{const{children:t,dialog:{id:n}}=e,i=wt(),a=yt((()=>{i(Ci.clear())}),[]);return Se(xa,{header:"Filters",id:n,onClose:a,width:1,children:[Se(Le,{padding:3,children:[_e(ia,{layout:"stack"}),_e(aa,{})]}),t]})},il=mn.object().shape({name:mn.string().required("Name cannot be empty")}),al=e=>{const{children:t,dialog:{id:n}}=e,i=wt(),a=bi((e=>e.tags.creating)),l=bi((e=>e.tags.creatingError)),{formState:{errors:o,isDirty:r,isValid:s},handleSubmit:d,register:c,setError:u}=gn({defaultValues:{name:""},mode:"onChange",resolver:pn(il)}),p=a,h=async e=>{const t=ha(e);i(Kn.createRequest({name:t.name}))};ut((()=>{l&&u("name",{message:null==l?void 0:l.message})}),[l]);return Se(xa,{footer:_e((()=>_e(Le,{padding:3,children:_e(je,{justify:"flex-end",children:_e(Ka,{disabled:p||!r||!s,isValid:s,onClick:d(h)})})})),{}),header:"Create Tag",id:n,onClose:()=>{i(Ci.clear())},width:1,children:[Se(Le,{as:"form",padding:4,onSubmit:d(h),children:[_e("button",{style:{display:"none"},tabIndex:-1,type:"submit"}),_e(Wa,{disabled:p,error:null==o?void 0:o.name,label:"Name",name:"name",ref:c})]}),t]})},ll=mn.object().shape({name:mn.string().required("Name cannot be empty")}),ol=e=>{const{children:t,dialog:{id:n,tagId:i}}=e,a=Pn(),l=wt(),o=bi((e=>Gn(e,String(i)))),[r,s]=gt(null==o?void 0:o.tag),d=o?null==o?void 0:o.tag:r,c=e=>{var t;return{name:(null==(t=null==e?void 0:e.name)?void 0:t.current)||""}},{formState:{errors:u,isDirty:p,isValid:h},handleSubmit:g,register:m,reset:y,setError:f}=gn({defaultValues:c(null==o?void 0:o.tag),mode:"onChange",resolver:pn(ll)}),v=!o||(null==o?void 0:o.updating),b=async e=>{var t;if(!(null==o?void 0:o.tag))return;const n=ha(e);l(Kn.updateRequest({closeDialogId:null==(t=null==o?void 0:o.tag)?void 0:t._id,formData:{name:{_type:"slug",current:n.name}},tag:null==o?void 0:o.tag}))},x=()=>{var e;(null==o?void 0:o.tag)&&l(Ci.showConfirmDeleteTag({closeDialogId:null==(e=null==o?void 0:o.tag)?void 0:e._id,tag:null==o?void 0:o.tag}))},C=e=>{const{result:t,transition:n}=e;t&&"update"===n&&(s(t),y(c(t)))};ut((()=>{var e;(null==o?void 0:o.error)&&f("name",{message:null==(e=o.error)?void 0:e.message})}),[null==o?void 0:o.error]),ut((()=>{if(!(null==o?void 0:o.tag))return;const e=a.listen(xt(T||(T=Y(["*[_id == $id]"]))),{id:null==o?void 0:o.tag._id}).subscribe(C);return()=>{null==e||e.unsubscribe()}}),[]);const w=()=>{var e;return _e(Le,{padding:3,children:Se(je,{justify:"space-between",children:[_e(ze,{disabled:v,fontSize:1,mode:"bleed",onClick:x,text:"Delete",tone:"critical"}),_e(Ka,{disabled:v||!p||!h,isValid:h,lastUpdated:null==(e=null==o?void 0:o.tag)?void 0:e._updatedAt,onClick:g(b)})]})})};return d?Se(xa,{footer:_e(w,{}),header:"Edit Tag",id:n,onClose:()=>{l(Ci.remove({id:n}))},width:1,children:[Se(Le,{as:"form",padding:4,onSubmit:g(b),children:[!o&&_e(Ne,{marginBottom:3,padding:3,radius:2,shadow:1,tone:"critical",children:_e(Pe,{size:1,children:"This tag cannot be found – it may have been deleted."})}),_e("button",{style:{display:"none"},tabIndex:-1,type:"submit"}),_e(Wa,{disabled:v,error:null==u?void 0:u.name,label:"Name",name:"name",ref:m})]}),t]}):null},rl=tn(je)(k||(k=Y(["\n  height: ","px;\n"])),Dn),sl=tn(je)(_||(_=Y(["\n  @media (pointer: fine) {\n    visibility: hidden;\n  }\n\n  @media (hover: hover) and (pointer: fine) {\n    ",":hover & {\n      visibility: visible;\n    }\n  }\n"])),rl),dl=e=>{const{disabled:t,icon:n,onClick:i,tone:a,tooltip:l}=e;return _e(Be,{content:_e(et,{padding:2,width:0,children:_e(Pe,{muted:!0,size:1,children:l})}),disabled:"ontouchstart"in window,placement:"top",children:_e(ze,{disabled:t,fontSize:1,icon:n,mode:"bleed",onClick:i,padding:2,tone:a})})},cl=e=>{var t,n;const{actions:i,tag:a}=e,l=wt(),o=bi(ui),r=bi(ei),s=bi((e=>{var t;return ti(e,null==(t=null==a?void 0:a.tag)?void 0:t._id)}));return Se(rl,{align:"center",flex:1,justify:"space-between",paddingLeft:3,children:[_e(Le,{flex:1,children:_e(Pe,{size:1,style:{color:(null==a?void 0:a.updating)?Zt.gray[800].hex:Zt.gray[500].hex,userSelect:"none"},textOverflow:"ellipsis",children:null==(n=null==(t=null==a?void 0:a.tag)?void 0:t.name)?void 0:n.current})}),Se(sl,{align:"center",style:{flexShrink:0},children:[(null==i?void 0:i.includes("search"))&&_e(dl,{disabled:null==a?void 0:a.updating,icon:_e(s?le:re,{}),onClick:s?()=>{l(ni.facetsRemove({facetName:"tag"}))}:()=>{var e,t,n;const i=X(X({},Sn.tag),{},{value:{label:null==(t=null==(e=null==a?void 0:a.tag)?void 0:e.name)?void 0:t.current,value:null==(n=null==a?void 0:a.tag)?void 0:n._id}});l(r?ni.facetsUpdate({name:"tag",operatorType:"references",value:i.value}):ni.facetsAdd({facet:i}))},tooltip:s?"Remove filter":"Filter by tag"}),(null==i?void 0:i.includes("edit"))&&_e(dl,{disabled:null==a?void 0:a.updating,icon:_e(me,{}),onClick:()=>{var e;l(Hn.showTagEdit({tagId:null==(e=null==a?void 0:a.tag)?void 0:e._id}))},tone:"primary",tooltip:"Edit tag"}),(null==i?void 0:i.includes("applyAll"))&&_e(dl,{disabled:null==a?void 0:a.updating,icon:_e(ye,{}),onClick:()=>{l(Ci.showConfirmAssetsTagAdd({assetsPicked:o,tag:a.tag}))},tone:"primary",tooltip:"Add tag to selected assets"}),(null==i?void 0:i.includes("removeAll"))&&_e(dl,{disabled:null==a?void 0:a.updating,icon:_e(fe,{}),onClick:()=>{l(Ci.showConfirmAssetsTagRemove({assetsPicked:o,tag:a.tag}))},tone:"critical",tooltip:"Remove tag from selected assets"}),(null==i?void 0:i.includes("delete"))&&_e(dl,{disabled:null==a?void 0:a.updating,icon:_e(ve,{}),onClick:()=>{l(Ci.showConfirmDeleteTag({tag:a.tag}))},tone:"critical",tooltip:"Delete tag"})]})]})},ul=ft((e=>{let{isScrolling:t,item:n}=e;var i;return"string"==typeof n?_e(je,{align:"center",justify:"space-between",paddingX:3,style:{height:"".concat(Dn,"px")},children:_e(Fe,{size:0,children:n})},n):_e(cl,{actions:t?void 0:n.actions,tag:n},null==(i=n.tag)?void 0:i._id)})),pl=()=>{const e=bi(ui),t=bi(Wn),[n,i]=gt(!1),a=null==e?void 0:e.reduce(((e,t)=>{var n,i,a,l;const o=(null==(l=null==(a=null==(i=null==(n=null==t?void 0:t.asset)?void 0:n.opt)?void 0:i.media)?void 0:a.tags)?void 0:l.map((e=>e._ref)))||[];return e=e.concat(o)}),[]),l=[...new Set(a)],o=l.reduce(((t,n)=>{const i=e.every((e=>{var t,i,a,l;return(null!=(l=null==(a=null==(i=null==(t=e.asset.opt)?void 0:t.media)?void 0:i.tags)?void 0:a.findIndex((e=>e._ref===n)))?l:-1)>=0}));return i?t.appliedToAll.push(n):t.appliedToSome.push(n),t}),{appliedToAll:[],appliedToSome:[]}),r=t.filter((e=>o.appliedToAll.includes(e.tag._id))).map((e=>X(X({},e),{},{actions:["delete","edit","removeAll","search"]}))),s=t.filter((e=>o.appliedToSome.includes(e.tag._id))).map((e=>X(X({},e),{},{actions:["applyAll","delete","edit","removeAll","search"]}))),d=t.filter((e=>!l.includes(e.tag._id))).map((e=>X(X({},e),{},{actions:["applyAll","delete","edit","search"]})));let c=[];return 0===e.length?c=t.map((e=>X(X({},e),{},{actions:["delete","edit","search"]}))):((null==r?void 0:r.length)>0&&(c=[...c,1===e.length?"Used":"Used by all",...r]),(null==s?void 0:s.length)>0&&(c=[...c,"Used by some",...s]),(null==d?void 0:d.length)>0&&(c=[...c,"Unused",...d])),_e(dn,{className:"media__custom-scrollbar",computeItemKey:e=>{const t=c[e];return"string"==typeof t?t:t.tag._id},isScrolling:i,itemContent:e=>_e(ul,{isScrolling:n,item:c[e]}),style:{flex:1,overflowX:"hidden"},totalCount:c.length})},hl=e=>{var t,n;const{allowCreate:i,light:a,title:l}=e,o=wt(),r=bi((e=>e.tags.creating)),s=bi((e=>e.tags.fetching));return _e(Re,{children:Se(je,{align:"center",justify:"space-between",paddingLeft:3,style:{background:a?null==(t=Zt.gray)?void 0:t[900].hex:en.hex,borderBottom:"1px solid ".concat(null==(n=Zt.gray)?void 0:n[900].hex),height:"".concat(Dn,"px")},children:[Se(Ee,{space:2,children:[_e(Fe,{size:0,children:l}),s&&_e(Fe,{size:0,style:{opacity:.3},children:"Loading..."})]}),i&&_e(Le,{marginRight:1,children:_e(ze,{disabled:r,fontSize:1,icon:be,mode:"bleed",onClick:()=>{o(Hn.showTagCreate())},style:{background:"transparent",boxShadow:"none"}})})]})})},gl=()=>{const e=bi(pi),t=bi(Wn),n=bi((e=>e.tags.fetching)),i=-1!==bi((e=>e.tags.fetchCount)),a=!n&&(null==t?void 0:t.length)>0,l=!!(e>0);return Se(je,{direction:"column",flex:1,style:{background:en.hex,height:"100%"},children:[_e(hl,{allowCreate:!0,light:l,title:l?"Tags (in selection)":"Tags"}),i&&!a&&_e(Le,{padding:3,children:_e(Pe,{size:1,style:{color:Zt.gray[700].hex},children:_e("em",{children:"No tags"})})}),a&&_e(pl,{})]})},ml=e=>{const{children:t,dialog:{id:n}}=e,i=wt(),a=yt((()=>{i(Ci.clear())}),[]);return Se(xa,{header:"All Tags",id:n,onClose:a,width:1,children:[_e(Le,{style:{height:"100%",minHeight:"420px"},children:_e(gl,{})}),t]})},yl=()=>{const e=bi((e=>e.dialog.items)),t=(e,n)=>{if(0===e.length||n>=e.length)return null;const i=e[n],a=t(e,n+1);return"assetEdit"===i.type?_e(el,{dialog:i,children:a},n):"confirm"===i.type?_e(tl,{dialog:i,children:a},n):"searchFacets"===i.type?_e(nl,{dialog:i,children:a},n):"tagCreate"===i.type?_e(al,{dialog:i,children:a},n):"tagEdit"===i.type?_e(ol,{dialog:i,children:a},n):"tags"===i.type?_e(ml,{dialog:i,children:a},n):null};return t(e,0)},fl=pt(void 0),vl=e=>{const{children:t,open:n}=e,i={open:n};return _e(fl.Provider,{value:i,children:t})},bl=e=>{const{onClose:t}=e,{open:n}=(()=>{const e=ht(fl);if(void 0===e)throw new Error("useDropzoneActions must be used within an DropzoneDispatchProvider");return e})(),{onSelect:i}=Fn(),a=bi((e=>e.assets.assetTypes)),l=bi((e=>e.selected.document));return _e(Le,{paddingY:2,children:Se(je,{align:"center",justify:"space-between",children:[_e(Le,{flex:1,marginX:3,children:Se(Ee,{style:{whiteSpace:"nowrap"},children:[_e(Pe,{textOverflow:"ellipsis",weight:"semibold",children:_e("span",{children:i?"Insert ".concat(a.join(" or ")):"Browse Assets"})}),l&&_e(Le,{display:["none","none","block"],children:Se(Pe,{children:[_e("span",{style:{margin:"0 0.5em"},children:_e(xe,{symbol:"arrow-right"})}),_e("span",{style:{textTransform:"capitalize"},children:l._type})]})})]})}),Se(je,{marginX:2,children:[_e(ze,{fontSize:1,icon:Ce,mode:"bleed",onClick:n,text:"Upload ".concat(1===a.length?ln(a[0]):"assets"),tone:"primary"}),t&&_e(Le,{style:{flexShrink:0},children:_e(ze,{disabled:!t,icon:le,mode:"bleed",onClick:t,radius:2})})]})]})})},xl=_t([e=>e.assets.allIds,e=>e.uploads.allIds],((e,t)=>{const n=e.map((e=>({id:e,type:"asset"})));return[...t.map((e=>({id:e,type:"upload"}))),...n]})),Cl=tn(je)(S||(S=Y(["\n  box-sizing: border-box;\n  height: 100%;\n  overflow: hidden;\n  padding: 2px;\n  position: relative;\n  width: 100%;\n"]))),wl=tn(je)(R||(R=Y(["\n  border: 1px solid transparent;\n  height: 100%;\n  pointer-events: ",";\n  position: relative;\n  transition: all 300ms;\n  user-select: none;\n  width: 100%;\n\n  border: ",";\n\n  ","\n"])),(e=>e.updating?"none":"auto"),(e=>e.picked?"1px solid ".concat(e.theme.sanity.color.spot.orange," !important"):"1px solid inherit"),(e=>!e.updating&&nn(E||(E=Y(["\n      @media (hover: hover) and (pointer: fine) {\n        &:hover {\n          border: 1px solid ",";\n        }\n      }\n    "])),Zt.gray[500].hex))),Il=tn(je)(z||(z=Y(["\n  cursor: ",";\n  height: ","px;\n  transition: all 300ms;\n\n  @media (hover: hover) and (pointer: fine) {\n    &:hover {\n      background: ",";\n    }\n  }\n"])),(e=>e.selected?"default":"pointer"),Dn,Zt.gray[950].hex),Tl=tn(we)((e=>{let{theme:t}=e;return{color:t.sanity.color.spot.red}}));var kl=ft((e=>{var t,n;const{id:i,selected:a}=e,l=kn("shift"),o=wt(),r=bi((e=>e.assets.lastPicked)),s=bi((e=>si(e,i))),d=null==s?void 0:s.asset,c=null==s?void 0:s.error,u=null==(n=null==(t=null==s?void 0:s.asset)?void 0:t.metadata)?void 0:n.isOpaque,p=null==s?void 0:s.picked,h=null==s?void 0:s.updating,{onSelect:g}=Fn();if(!d)return null;const m=h?.5:1,y=a||h?.25:1;return _e(Cl,{children:Se(wl,{direction:"column",picked:p,updating:s.updating,children:[Se(Le,{flex:1,style:{cursor:a?"default":"pointer",position:"relative"},children:[Se("div",{onClick:e=>{e.stopPropagation(),g?g([{kind:"assetDocumentId",value:d._id}]):l.current?o(p?hi.pick({assetId:d._id,picked:!p}):hi.pickRange({startId:r||d._id,endId:d._id})):o(Ci.showAssetEdit({assetId:d._id}))},style:{height:"100%",opacity:y},children:[ga(d)&&_e(ka,{extension:d.extension,width:"80px"}),ma(d)&&_e(Za,{draggable:!1,showCheckerboard:!u,src:pa(d,{height:250,width:250}),style:{draggable:!1,transition:"opacity 1000ms"}})]}),a&&!h&&_e(je,{align:"center",justify:"center",style:{height:"100%",left:0,opacity:m,position:"absolute",top:0,width:"100%"},children:_e(Pe,{size:2,children:_e(Ie,{})})}),h&&_e(je,{align:"center",justify:"center",style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"},children:_e(tt,{})})]}),Se(Il,{align:"center",onClick:e=>{e.stopPropagation(),g?o(Ci.showAssetEdit({assetId:d._id})):l.current&&!p?o(hi.pickRange({startId:r||d._id,endId:d._id})):o(hi.pick({assetId:d._id,picked:!p}))},paddingX:1,style:{opacity:m},children:[g?_e(me,{style:{flexShrink:0,opacity:.5}}):_e(nt,{checked:p,readOnly:!0,style:{flexShrink:0,pointerEvents:"none",transform:"scale(0.8)"}}),_e(Le,{marginLeft:2,children:_e(Pe,{muted:!0,size:0,textOverflow:"ellipsis",children:d.originalFilename})})]}),c&&_e(Le,{padding:3,style:{position:"absolute",right:0,top:0},children:_e(Be,{content:_e(et,{padding:2,width:0,children:_e(Pe,{size:1,children:c})}),placement:"left",portal:!0,children:_e(Pe,{size:1,children:_e(Tl,{color:"critical"})})})})]})})}));const _l=180,Sl=async e=>{const t=await(e=>new Promise((t=>{const n=window.URL.createObjectURL(e),i=new Image;i.onload=()=>{window.URL.revokeObjectURL(n),t(i)},i.src=n})))(e),n=await(i=t,new Promise((e=>{const t=i.width/i.height,n=document.createElement("canvas");n.width=_l,n.height=Math.max(_l/t,1);try{const a=n.getContext("2d");null==a||a.drawImage(i,0,0,_l,_l/t),n.toBlob(e,"image/jpeg")}catch(e){console.warn("Unable to generate preview image:",e)}})));var i;if(!n)throw Error("Unable to generate file Blob");return window.URL.createObjectURL(n)},Rl=4;function El(e,t){const n=e.indexOf(t);return n>-1&&e.splice(n,1),e}const zl=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Rl;const t=[],n=[],i=new Pt;return function a(l){return new Ut((o=>{if(t.length>=e)return function(e){return n.push(e),i.asObservable().pipe(Wt((t=>t===e)))}(l).pipe(Vt(a)).subscribe(o);const r=l.subscribe(o);return t.push(r),()=>{for(El(t,r),El(n,l),r.unsubscribe();n.length>0&&t.length<e;)i.next(n.shift())}}))}},Al=e=>Array.prototype.map.call(new Uint8Array(e),(e=>"00".concat(e.toString(16)).slice(-2))).join(""),Ol=e=>window.crypto&&window.crypto.subtle&&window.FileReader?(e=>new Ut((t=>{const n=new FileReader;return n.onload=()=>{t.next(n.result),t.complete()},n.onerror=e=>{t.error(e)},n.readAsArrayBuffer(e),()=>{n.abort()}})))(e).pipe(Vt((e=>window.crypto.subtle.digest("SHA-1",e))),Gt(Al)):qt({message:"Unable to generate hash: uploads are only allowed in secure contexts",statusCode:500}),Dl=function(e){const t=zl(arguments.length>1&&void 0!==arguments[1]?arguments[1]:Rl);return function(){return jt(t(e(...arguments)))}}(((e,t,n,i)=>Lt(null).pipe(Vt((()=>((e,t,n)=>e.observable.fetch("*[_type == $documentType && sha1hash == $hash][0]",{documentType:t,hash:n}))(e,"sanity.".concat(t,"Asset"),i))),Vt((e=>e?qt({message:"Asset already exists",statusCode:409}):Lt(null))),Vt((()=>e.observable.assets.upload(t,n,{extract:["blurhash","exif","location","lqip","palette"],preserveFilename:!0}).pipe(Gt((e=>"response"===e.type?{asset:e.body.document,id:e.body.document._id,type:"complete"}:e)))))))),ql=kt({name:"uploads",initialState:{allIds:[],byIds:{}},extraReducers:e=>{e.addCase(ai.uploadComplete,((e,t)=>{const{asset:n}=t.payload;e.byIds[n.sha1hash]&&(e.byIds[n.sha1hash].status="complete")}))},reducers:{checkRequest(e,t){},checkComplete(e,t){const{results:n}=t.payload;Object.keys(n).forEach((t=>{const n=e.allIds.indexOf(t);if(n>=0&&e.allIds.splice(n,1),e.byIds[t]){const n=e.byIds[t].objectUrl;n&&window.URL.revokeObjectURL(n),delete e.byIds[t]}}))},previewReady(e,t){const{blobUrl:n,hash:i}=t.payload;e.byIds[i]&&(e.byIds[i].objectUrl=n)},uploadCancel(e,t){const{hash:n}=t.payload,i=e.allIds.indexOf(n);i>=0&&e.allIds.splice(i,1),e.byIds[n]&&delete e.byIds[n]},uploadError(e,t){const{hash:n}=t.payload,i=e.allIds.indexOf(n);i>=0&&e.allIds.splice(i,1),delete e.byIds[n]},uploadRequest(e,t){},uploadProgress(e,t){const{event:n,uploadHash:i}=t.payload;e.byIds[i].percent=n.percent,e.byIds[i].status="uploading"},uploadStart(e,t){const{uploadItem:n}=t.payload;e.allIds.includes(n.hash)||e.allIds.push(n.hash),e.byIds[n.hash]=n}}}),Ll=_t([e=>e.uploads.byIds,(e,t)=>t],((e,t)=>e[t]));_t([e=>e.uploads.byIds,e=>e.uploads.allIds],((e,t)=>t.map((t=>e[t]))));const jl=ql.actions;var Fl=ql.reducer;const Pl=tn(je)(O||(O=Y(["\n  box-sizing: border-box;\n  height: 100%;\n  overflow: hidden;\n  padding: 2px;\n  position: relative;\n  width: 100%;\n"]))),Ul=e=>{const{id:t}=e,n=wt(),i=bi((e=>Ll(e,t)));if(!i)return null;const a=fn(i.size,{base:10,round:0}),l=Math.round(i.percent||0),o="complete"===i.status,r="uploading"===i.status,s="queued"===i.status;let d;o&&(d="Verifying"),r&&(d="".concat(l,"%")),s&&(d="Queued");return _e(Pl,{children:Se(je,{direction:"column",flex:1,style:{background:Zt.gray[950].hex,border:"1px solid transparent",height:"100%",position:"relative"},children:[_e("div",{style:{background:Zt.gray[600].hex,bottom:0,height:"1px",left:0,position:"absolute",width:"100%",transform:"scaleX(".concat(.01*l,")"),transformOrigin:"bottom left",transition:"all 1000ms ease-out"}}),Se(Le,{flex:1,style:{position:"relative"},children:["image"===i.assetType&&(null==i?void 0:i.objectUrl)&&_e(Za,{draggable:!1,src:i.objectUrl,style:{opacity:.4}}),"file"===i.assetType&&_e("div",{style:{height:"100%",opacity:.1},children:_e(ka,{width:"80px"})}),!o&&100!==l&&_e(je,{align:"center",direction:"column",justify:"center",style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"},children:_e(Be,{content:_e(Le,{padding:2,children:_e(Pe,{muted:!0,size:1,children:"Cancel"})}),disabled:"ontouchstart"in window,placement:"top",children:_e(ze,{fontSize:4,icon:le,mode:"bleed",onClick:()=>{n(jl.uploadCancel({hash:i.hash}))},padding:2,style:{background:"none",boxShadow:"none"},tone:"critical"})})})]}),Se(je,{align:"center",justify:"space-between",paddingX:2,style:{height:"".concat(Dn,"px")},children:[_e(Le,{flex:1,marginRight:1,children:Se(Pe,{size:0,textOverflow:"ellipsis",children:[i.name," (",a,")"]})}),_e(Pe,{size:0,style:{flexShrink:0},weight:"semibold",children:d})]})]})})},Ml=ft((e=>{let{item:t,selected:n}=e;return"asset"===(null==t?void 0:t.type)?_e(kl,{id:t.id,selected:n}):"upload"===(null==t?void 0:t.type)?_e(Ul,{id:t.id}):null})),Nl=tn.div(D||(D=Y(["\n  height: ","px;\n  width: ","px;\n"])),220,240),Vl=tn.div(q||(q=Y(["\n  display: grid;\n  grid-template-columns: repeat(auto-fill, ","px);\n  justify-content: center;\n  margin: 0 auto;\n"])),240),Ql=e=>{const{items:t,onLoadMore:n}=e,i=bi((e=>e.selected.assets)),a=i&&i.map((e=>e._id))||[],l=null==t?void 0:t.length;return 0===l?null:_e(cn,{className:"media__custom-scrollbar",computeItemKey:e=>{const n=t[e];return null==n?void 0:n.id},components:{Item:Nl,List:Vl},endReached:n,itemContent:e=>{const n=t[e],i=a.includes(null==n?void 0:n.id);return _e(Ml,{item:n,selected:i})},overscan:48,style:{overflowX:"hidden"},totalCount:l})},Bl=e=>{const{field:t,title:n}=e,i=wt(),a=bi((e=>e.assets.order)),l=a.field===t;return _e(Fe,{muted:!t,size:0,children:Se(Le,{onClick:t?()=>{if(t&&n)if(l){const e="asc"===a.direction?"desc":"asc";i(hi.orderSet({order:{field:t,direction:e}}))}else i(hi.orderSet({order:{field:t,direction:"asc"}}))}:void 0,style:{cursor:t?"pointer":"default",display:"inline",whiteSpace:"nowrap"},children:[_e("span",{style:{marginRight:"0.4em"},children:n}),l&&"asc"===(null==a?void 0:a.direction)&&_e(Te,{}),l&&"desc"===(null==a?void 0:a.direction)&&_e(ue,{})]})})};var Xl;const Hl=tn(je)(L||(L=Y(["\n  cursor: pointer;\n\n  @media (hover: hover) and (pointer: fine) {\n    &:hover {\n      background: ",";\n    }\n  }\n"])),null==(Xl=Zt.gray)?void 0:Xl[900].hex),Yl=()=>{var e;const t=wt(),n=bi((e=>e.assets.fetching)),i=bi(ci),a=bi(pi),l=Qe(),{onSelect:o}=Fn(),r=a===i;return Se(it,{style:{alignItems:"center",background:en.hex,borderBottom:"1px solid ".concat(null==(e=Zt.gray)?void 0:e[900].hex),gridColumnGap:l<3?0:"16px",gridTemplateColumns:On,height:l<3?0:"".concat(Dn,"px"),letterSpacing:"0.025em",position:"sticky",textTransform:"uppercase",top:0,visibility:l<3?"hidden":"visible",width:"100%",zIndex:1},children:[o?_e(Bl,{}):_e(Hl,{align:"center",justify:"center",onClick:e=>{e.stopPropagation(),t(r?hi.pickClear():hi.pickAll())},style:{height:"100%",position:"relative"},children:_e(nt,{checked:!n&&r,readOnly:!0,style:{pointerEvents:"none",transform:"scale(0.8)"}})}),_e(Bl,{}),_e(Bl,{field:"originalFilename",title:"Filename"}),_e(Bl,{title:"Resolution"}),_e(Bl,{field:"mimeType",title:"MIME type"}),_e(Bl,{field:"size",title:"Size"}),_e(Bl,{field:"_updatedAt",title:"Last updated"}),_e(Bl,{})]})};var $l;const Wl=tn(it)(j||(j=Y(["\n  align-items: center;\n  cursor: ",";\n  height: 100%;\n  pointer-events: ",";\n  user-select: none;\n  white-space: nowrap;\n\n  ","\n"])),(e=>e.selected?"default":"pointer"),(e=>e.updating?"none":"auto"),(e=>{var t;return!e.updating&&nn(F||(F=Y(["\n      @media (hover: hover) and (pointer: fine) {\n        &:hover {\n          background: ",";\n        }\n      }\n    "])),null==(t=Zt.gray)?void 0:t[950].hex)})),Gl=tn(je)(P||(P=Y(["\n  cursor: pointer;\n\n  @media (hover: hover) and (pointer: fine) {\n    &:hover {\n      background: ",";\n    }\n  }\n"])),null==($l=Zt.gray)?void 0:$l[900].hex),Kl=tn(we)((e=>{let{theme:t}=e;return{color:t.sanity.color.spot.red}}));var Zl=ft((e=>{var t,n;const{id:i,selected:a}=e,l=kn("shift"),o=wt(),r=bi((e=>e.assets.lastPicked)),s=bi((e=>si(e,i))),d=Qe(),c=null==s?void 0:s.asset,u=null==s?void 0:s.error,p=null==(n=null==(t=null==s?void 0:s.asset)?void 0:t.metadata)?void 0:n.isOpaque,h=null==s?void 0:s.picked,g=null==s?void 0:s.updating,{onSelect:m}=Fn();if(!c)return null;const y=g?.5:1,f=a||g?.1:1;return Se(Wl,{onClick:a?void 0:e=>{e.stopPropagation(),m?m([{kind:"assetDocumentId",value:c._id}]):l.current?o(h?hi.pick({assetId:c._id,picked:!h}):hi.pickRange({startId:r||c._id,endId:c._id})):o(Ci.showAssetEdit({assetId:c._id}))},selected:a,style:{gridColumnGap:d<3?0:"16px",gridRowGap:0,gridTemplateColumns:d<3?An:On,gridTemplateRows:d<3?"auto":"1fr"},updating:s.updating,children:[_e(Gl,{onClick:e=>{e.stopPropagation(),m?o(Ci.showAssetEdit({assetId:c._id})):l.current&&!h?o(hi.pickRange({startId:r||c._id,endId:c._id})):o(hi.pick({assetId:c._id,picked:!h}))},style:{alignItems:"center",gridColumn:1,gridRowStart:1,gridRowEnd:"span 5",height:"100%",justifyContent:"center",opacity:y,position:"relative"},children:m?_e(me,{style:{flexShrink:0,opacity:.5}}):_e(nt,{checked:h,readOnly:!0,style:{pointerEvents:"none",transform:"scale(0.8)"}})}),_e(Le,{style:{gridColumn:2,gridRowStart:1,gridRowEnd:"span 5",height:"90px",width:"100px"},children:Se(je,{align:"center",justify:"center",style:{height:"100%",position:"relative"},children:[Se(Le,{style:{height:"100%",opacity:f,position:"relative"},children:[ga(c)&&_e(ka,{extension:c.extension,width:"40px"}),ma(c)&&_e(Za,{draggable:!1,showCheckerboard:!p,src:pa(c,{height:100,width:100})})]}),g&&_e(je,{align:"center",justify:"center",style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"},children:_e(tt,{})}),a&&!g&&_e(je,{align:"center",justify:"center",style:{height:"100%",left:0,position:"absolute",top:0,width:"100%"},children:_e(Pe,{size:2,children:_e(Ie,{})})})]})}),_e(Le,{marginLeft:d<3?3:0,style:{gridColumn:3,gridRow:d<3?2:"auto",opacity:y},children:_e(Pe,{muted:!0,size:1,style:{lineHeight:"2em"},textOverflow:"ellipsis",children:c.originalFilename})}),_e(Le,{marginLeft:d<3?3:0,style:{gridColumn:d<3?3:4,gridRow:d<3?3:"auto",opacity:y},children:_e(Pe,{muted:!0,size:1,style:{lineHeight:"2em"},textOverflow:"ellipsis",children:ma(c)&&ya(c)})}),_e(Le,{style:{display:d<3?"none":"block",gridColumn:5,gridRow:"auto",opacity:y},children:_e(Pe,{muted:!0,size:1,style:{lineHeight:"2em"},textOverflow:"ellipsis",children:c.mimeType})}),_e(Le,{style:{display:d<3?"none":"block",gridColumn:6,gridRow:"auto",opacity:y},children:_e(Pe,{muted:!0,size:1,style:{lineHeight:"2em"},textOverflow:"ellipsis",children:fn(c.size,{base:10,round:0})})}),_e(Le,{marginLeft:d<3?3:0,style:{gridColumn:d<3?3:7,gridRow:d<3?4:"auto",opacity:y},children:_e(Pe,{muted:!0,size:1,style:{lineHeight:"2em"},textOverflow:"ellipsis",children:In(new Date(c._updatedAt),new Date)})}),_e(je,{align:"center",justify:"center",style:{gridColumn:d<3?4:8,gridRowStart:"1",gridRowEnd:d<3?"span 5":"auto",opacity:y},children:u&&_e(Le,{padding:2,children:_e(Be,{content:_e(et,{padding:2,width:0,children:_e(Pe,{size:1,children:u})}),placement:"left",portal:!0,children:_e(Pe,{size:1,children:_e(Kl,{color:"critical"})})})})})]})}));const Jl=e=>{const{id:t}=e,n=wt(),i=bi((e=>Ll(e,t))),a=Qe();if(!i)return null;const l=fn(i.size,{base:10,round:0}),o=Math.round(i.percent||0),r="complete"===i.status,s="uploading"===i.status,d="queued"===i.status;let c;r&&(c="Verifying"),s&&(c="".concat(o,"%")),d&&(c="Queued");return Se(it,{style:{alignItems:"center",background:Zt.gray[950].hex,gridColumnGap:a<3?0:"16px",gridRowGap:0,gridTemplateColumns:a<3?An:On,gridTemplateRows:a<3?"auto":"1fr",height:"100%",position:"relative"},children:[_e("div",{style:{background:Zt.gray[600].hex,bottom:0,height:"1px",left:0,position:"absolute",width:"100%",transform:"scaleX(".concat(.01*o,")"),transformOrigin:"bottom left",transition:"all 1000ms ease-out"}}),_e(Le,{style:{gridColumn:2,gridRowStart:a<3?1:"auto",gridRowEnd:a<3?"span 4":"auto",height:"90px",width:"100px"},children:Se(Le,{style:{height:"100%",position:"relative"},children:["image"===i.assetType&&(null==i?void 0:i.objectUrl)&&_e(Za,{draggable:!1,src:i.objectUrl,style:{opacity:.25}}),"file"===i.assetType&&_e("div",{style:{height:"100%",opacity:.1},children:_e(ka,{width:"40px"})}),!r&&100!==o&&_e(je,{align:"center",justify:"center",style:{position:"absolute",height:"100%",left:0,top:0,width:"100%"},children:_e(Be,{content:_e(Le,{padding:2,children:_e(Pe,{muted:!0,size:1,children:"Cancel"})}),disabled:"ontouchstart"in window,placement:"top",children:_e(ze,{fontSize:3,icon:le,mode:"bleed",onClick:()=>{n(jl.uploadCancel({hash:i.hash}))},padding:2,style:{background:"none",boxShadow:"none"},tone:"critical"})})})]})}),_e(Le,{style:{gridColumn:a<3?3:"3/8",gridRow:a<3?"2/4":"auto",marginLeft:a<3?3:0},children:Se(Ye,{space:3,children:[Se(Pe,{muted:!0,size:1,textOverflow:"ellipsis",children:[i.name," (",l,")"]}),_e(Pe,{size:1,textOverflow:"ellipsis",weight:"semibold",children:c})]})})]})},eo=ft((e=>{let{item:t,selected:n}=e;return"asset"===(null==t?void 0:t.type)?_e(Le,{style:{height:"100px"},children:_e(Zl,{id:t.id,selected:n})}):"upload"===(null==t?void 0:t.type)?_e(Le,{style:{height:"100px"},children:_e(Jl,{id:t.id})}):null})),to=e=>{const{items:t,onLoadMore:n}=e,i=bi((e=>e.selected.assets)),a=i&&i.map((e=>e._id))||[],l=null==t?void 0:t.length;return 0===l?null:_e(un,{className:"media__custom-scrollbar",computeItemKey:e=>{const n=t[e];return(null==n?void 0:n.id)||e},endReached:n,groupCounts:Array(1).fill(l),groupContent:()=>_e(Yl,{}),itemContent:e=>{const n=t[e],i=a.includes(null==n?void 0:n.id);return _e(eo,{item:n,selected:i})},style:{overflowX:"hidden"}})},no=()=>{const e=wt(),t=bi((e=>e.assets.fetchCount)),n=bi((e=>e.assets.fetching)),i=bi((e=>e.tags.panelVisible)),a=bi((e=>e.assets.view)),l=bi(xl),o=(()=>{var e,t;const n=null==(t=null==(e=Me)?void 0:e.container)?void 0:t.map((e=>window.matchMedia("(max-width: ".concat(e,"px)")))),i=()=>n.findIndex((e=>e.matches)),[a,l]=gt(i());return ut((()=>{const e=()=>{l(i)};return n.forEach((t=>{try{t.addEventListener("change",e)}catch(n){try{t.addListener(e)}catch(e){}}})),()=>{try{n.forEach((t=>t.removeEventListener("change",e)))}catch(t){try{n.forEach((t=>t.removeListener(e)))}catch(e){}}}}),[]),a})(),r=t>=0,s=l.length>0,d=()=>{n||e(hi.loadNextPage())};ut((()=>{o<=1&&i&&e(Kn.panelVisibleSet({panelVisible:!1}))}),[o]);return _e(Le,{flex:1,style:{width:"100%"},children:!s&&r&&!n?_e(Le,{padding:4,children:_e(Pe,{size:1,weight:"semibold",children:"No results for the current query"})}):Se(Re,{children:["grid"===a&&_e(Ql,{items:l,onLoadMore:d}),"table"===a&&_e(to,{items:l,onLoadMore:d})]})})},io=()=>{const e=bi((e=>e.notifications.items)),t=at();return ut((()=>{if(e.length>0){const n=e[e.length-1];t.push({closable:!0,status:n.status,title:n.title})}}),[e.length]),null},ao=()=>{var e,t;const n=wt(),i=bi(ui);return 0===i.length?null:_e(je,{align:"center",justify:"flex-start",style:{background:null==(e=Zt.gray)?void 0:e[900].hex,borderBottom:"1px solid ".concat(null==(t=Zt.gray)?void 0:t[900].hex),height:"".concat(Dn,"px"),position:"relative",width:"100%"},children:Se(je,{align:"center",paddingX:3,children:[_e(Le,{paddingRight:2,children:Se(Fe,{size:0,style:{color:"inherit"},children:[i.length," ",ln("asset",i.length)," selected"]})}),_e(ze,{mode:"bleed",onClick:()=>{n(hi.pickClear())},padding:2,style:{background:"none",boxShadow:"none"},tone:"default",children:_e(Fe,{size:0,children:"Deselect"})}),_e(ze,{mode:"bleed",onClick:()=>{n(Ci.showConfirmDeleteAssets({assets:i}))},padding:2,style:{background:"none",boxShadow:"none"},tone:"critical",children:_e(Fe,{size:0,children:"Delete"})})]})})};var lo=kt({name:"selected",initialState:{assets:[],document:void 0,documentAssetIds:[]},reducers:{}}).reducer;const oo=kt({name:"notifications",initialState:{items:[]},reducers:{add(e,t){const{asset:n,status:i,title:a}=t.payload;e.items.push({asset:n,status:i,title:a})}}}),ro=oo.actions;var so=oo.reducer;const co=At(((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(hi.deleteRequest.match),Vt((e=>{const{assets:t}=e.payload,n=t.map((e=>e._id));return Lt(t).pipe(Vt((()=>i.observable.delete({query:xt(p||(p=Y(["*[_id in ","]"])),JSON.stringify(n))}))),Vt((()=>Lt(hi.deleteComplete({assetIds:n})))),Xt((e=>Lt(hi.deleteError({assetIds:n,error:e})))))})))}),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(hi.fetchRequest.match),Bt(t),Ht((e=>{let[t,n]=e;var a,l;const o=null==(a=t.payload)?void 0:a.params,r=null==(l=t.payload)?void 0:l.query;return Lt(t).pipe(Nn(n.debug.badConnection),Vt((()=>i.observable.fetch(r,o))),Vt((e=>{const{items:t}=e;return Lt(hi.fetchComplete({assets:t}))})),Xt((e=>Lt(hi.fetchError({message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500})))))})))}),((e,t)=>e.pipe(Qt(hi.deleteComplete.match),Bt(t),Ht((e=>{let[t,n]=e;if(0===n.assets.allIds.length){const e=Math.floor(n.assets.allIds.length/n.assets.pageSize);return Lt(hi.loadPageIndex({pageIndex:e}))}return Ft()})))),((e,t)=>e.pipe(Qt(hi.loadNextPage.match),Bt(t),Ht((e=>{let[t,n]=e;return Lt(hi.loadPageIndex({pageIndex:n.assets.pageIndex+1}))})))),((e,t)=>e.pipe(Qt(hi.loadPageIndex.match),Bt(t),Ht((e=>{let[t,n]=e;var i,a,l,o,r,s;const d=n.assets.pageSize,c=t.payload.pageIndex*d,u=c+d,p=null==(i=null==n?void 0:n.selected.document)?void 0:i._id,m=null==(a=null==n?void 0:n.selected)?void 0:a.documentAssetIds,y=Vn({assetTypes:n.assets.assetTypes,searchFacets:n.search.facets,searchQuery:n.search.query}),f=X(X({},p?{documentId:p}:{}),{},{documentAssetIds:m});return Lt(hi.fetchRequest({params:f,queryFilter:y,selector:xt(h||(h=Y(["[","...","]"])),c,u),sort:xt(g||(g=Y(["order("," ",")"])),null==(o=null==(l=n.assets)?void 0:l.order)?void 0:o.field,null==(s=null==(r=n.assets)?void 0:r.order)?void 0:s.direction)}))})))),(e=>e.pipe(Qt(hi.listenerCreateQueue.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=null==e?void 0:e.map((e=>e.payload.asset));return Lt(hi.listenerCreateQueueComplete({assets:t}))})))),(e=>e.pipe(Qt(hi.listenerDeleteQueue.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=null==e?void 0:e.map((e=>e.payload.assetId));return Lt(hi.listenerDeleteQueueComplete({assetIds:t}))})))),(e=>e.pipe(Qt(hi.listenerUpdateQueue.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=null==e?void 0:e.map((e=>e.payload.asset));return Lt(hi.listenerUpdateQueueComplete({assets:t}))})))),(e=>e.pipe(Qt(hi.orderSet.match),Vt((()=>Lt(hi.clear(),hi.loadPageIndex({pageIndex:0})))))),(e=>e.pipe(zt(ni.facetsAdd.type,ni.facetsClear.type,ni.facetsRemove.type,ni.facetsUpdate.type,ni.querySet.type),$t(400),Vt((()=>Lt(hi.clear(),hi.loadPageIndex({pageIndex:0})))))),(e=>e.pipe(zt(hi.insertUploads.type,hi.listenerUpdateQueueComplete.type,hi.updateComplete.type),Vt((()=>Lt(hi.sort()))))),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(Xn.tagsAddRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{assets:a,tag:l}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Vt((()=>{const e=ui(n),t=null==e?void 0:e.filter((e=>t=>{var n,i,a,l,o;return(null!=(o=null==(l=null==(a=null==(i=null==(n=null==t?void 0:t.asset)?void 0:n.opt)?void 0:i.media)?void 0:a.tags)?void 0:l.findIndex((t=>t._ref===(null==e?void 0:e._id))))?o:-1)<0})(l)),a=t.reduce(((e,t)=>{var n;return e.patch(null==(n=null==t?void 0:t.asset)?void 0:n._id,(e=>{let{tag:t}=e;return e=>e.setIfMissing({opt:{}}).setIfMissing({"opt.media":{}}).setIfMissing({"opt.media.tags":[]}).append("opt.media.tags",[{_key:Et(),_ref:null==t?void 0:t._id,_type:"reference",_weak:!0}])})({tag:l}))}),i.transaction());return jt(a.commit())})),Vt((()=>Lt(Xn.tagsAddComplete({assets:a,tag:l})))),Xt((e=>Lt(Xn.tagsAddError({assets:a,error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500},tag:l})))))})))}),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(Xn.tagsRemoveRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{assets:a,tag:l}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Vt((()=>{const e=ui(n).reduce(((e,t)=>{var n;return e.patch(null==(n=null==t?void 0:t.asset)?void 0:n._id,(e=>{let{asset:t,tag:n}=e;return e=>{var i;return e.ifRevisionId(null==(i=null==t?void 0:t.asset)?void 0:i._rev).unset(['opt.media.tags[_ref == "'.concat(n._id,'"]')])}})({asset:t,tag:l}))}),i.transaction());return jt(e.commit())})),Vt((()=>Lt(Xn.tagsRemoveComplete({assets:a,tag:l})))),Xt((e=>Lt(Xn.tagsRemoveError({assets:a,error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500},tag:l})))))})))}),(e=>e.pipe(zt(hi.orderSet.type,hi.viewSet.type,ni.facetsAdd.type,ni.facetsClear.type,ni.facetsRemove.type,ni.facetsUpdate.type,ni.querySet.type),Vt((()=>Lt(hi.pickClear()))))),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(hi.updateRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{asset:a,closeDialogId:l,formData:o}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Vt((()=>jt(i.patch(a._id).setIfMissing({opt:{}}).setIfMissing({"opt.media":{}}).set(o).commit()))),Vt((e=>Lt(hi.updateComplete({asset:e,closeDialogId:l})))),Xt((e=>Lt(hi.updateError({asset:a,error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500}})))))})))}),(e=>e.pipe(zt(hi.deleteComplete.type,hi.updateComplete.type,Kn.deleteComplete.type,Kn.updateComplete.type),Qt((e=>{var t;return!!(null==(t=null==e?void 0:e.payload)?void 0:t.closeDialogId)})),Vt((e=>{var t;const n=null==(t=null==e?void 0:e.payload)?void 0:t.closeDialogId;return n?Lt(xi.actions.remove({id:n})):Ft()})))),(e=>e.pipe(Qt(Kn.createComplete.match),Vt((e=>{const{assetId:t,tag:n}=null==e?void 0:e.payload;return t?Lt(xi.actions.inlineTagCreate({tag:n,assetId:t})):n._id?Lt(xi.actions.remove({id:"tagCreate"})):Ft()})))),(e=>e.pipe(Qt(Kn.listenerDeleteQueueComplete.match),Vt((e=>{const{tagIds:t}=null==e?void 0:e.payload;return Lt(xi.actions.inlineTagRemove({tagIds:t}))})))),(e=>e.pipe(Qt(hi.deleteError.match),Vt((e=>{const{assetIds:t}=e.payload,n=t.length;return Lt(oo.actions.add({status:"error",title:"Unable to delete ".concat(n," ").concat(ln("asset",n),". Please review any asset errors and try again.")}))})))),(e=>e.pipe(Qt(hi.deleteComplete.match),Vt((e=>{const{assetIds:t}=e.payload,n=t.length;return Lt(oo.actions.add({status:"info",title:"".concat(n," ").concat(ln("asset",n)," deleted")}))})))),(e=>e.pipe(Qt(Xn.tagsAddComplete.match),Vt((e=>{var t,n;const i=null==(n=null==(t=null==e?void 0:e.payload)?void 0:t.assets)?void 0:n.length;return Lt(oo.actions.add({status:"info",title:"Tag added to ".concat(i," ").concat(ln("asset",i))}))})))),(e=>e.pipe(Qt(Xn.tagsRemoveComplete.match),Vt((e=>{var t,n;const i=null==(n=null==(t=null==e?void 0:e.payload)?void 0:t.assets)?void 0:n.length;return Lt(oo.actions.add({status:"info",title:"Tag removed from ".concat(i," ").concat(ln("asset",i))}))})))),(e=>e.pipe(Qt(hi.updateComplete.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=e.length;return Lt(oo.actions.add({status:"info",title:"".concat(t," ").concat(ln("asset",t)," updated")}))})))),(e=>e.pipe(zt(hi.fetchError.type,hi.updateError.type,Kn.createError.type,Kn.deleteError.type,Kn.fetchError.type,Kn.updateError.type,jl.uploadError.type),Vt((e=>{var t;const n=null==(t=e.payload)?void 0:t.error;return Lt(oo.actions.add({status:"error",title:"An error occured: ".concat(n.message)}))})))),(e=>e.pipe(Qt(Kn.createComplete.match),Vt((()=>Lt(oo.actions.add({status:"info",title:"Tag created"})))))),(e=>e.pipe(Qt(Kn.deleteComplete.match),Vt((()=>Lt(oo.actions.add({status:"info",title:"Tag deleted"})))))),(e=>e.pipe(Qt(Kn.updateComplete.match),Vt((()=>Lt(oo.actions.add({status:"info",title:"Tag updated"})))))),((e,t)=>e.pipe(Qt(Kn.updateComplete.match),Bt(t),Vt((e=>{let[t,n]=e;var i,a,l,o,r;const{tag:s}=t.payload,d=null==(i=n.search.facets)?void 0:i.find((e=>"tag"===e.name)),c=n.tags.byIds[s._id];return"searchable"===(null==d?void 0:d.type)&&(null==(a=d.value)?void 0:a.value)===s._id?Lt(Jn.actions.facetsUpdate({name:"tag",value:{label:null==(o=null==(l=null==c?void 0:c.tag)?void 0:l.name)?void 0:o.current,value:null==(r=null==c?void 0:c.tag)?void 0:r._id}})):Ft()})))),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(Yn.actions.createRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{assetId:a,name:l}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Qn(i,l),Vt((()=>i.observable.create({_type:qn,name:{_type:"slug",current:l}}))),Vt((e=>Lt(Yn.actions.createComplete({assetId:a,tag:e})))),Xt((e=>Lt(Yn.actions.createError({error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500},name:l})))))})))}),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(Yn.actions.deleteRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{tag:a}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Vt((()=>i.observable.fetch(xt(d||(d=Y(['*[\n              _type in ["sanity.fileAsset", "sanity.imageAsset"]\n              && references(*[_type == "media.tag" && name.current == $tagName]._id)\n            ] {\n              _id,\n              _rev,\n              opt\n            }']))),{tagName:a.name.current}))),Vt((e=>{const t=e.map((e=>({id:e._id,patch:{ifRevisionID:e._rev,unset:['opt.media.tags[_ref == "'.concat(a._id,'"]')]}}))).reduce(((e,t)=>e.patch(t.id,t.patch)),i.transaction());return t.delete(a._id),jt(t.commit())})),Vt((()=>Lt(Yn.actions.deleteComplete({tagId:a._id})))),Xt((e=>Lt(Yn.actions.deleteError({error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500},tag:a})))))})))}),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(Yn.actions.fetchRequest.match),Bt(t),Ht((e=>{let[t,n]=e;const{query:a}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Vt((()=>i.observable.fetch(a))),Vt((e=>{const{items:t}=e;return Lt(Yn.actions.fetchComplete({tags:t}))})),Xt((e=>Lt(Yn.actions.fetchError({error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500}})))))})))}),(e=>e.pipe(Qt(Yn.actions.listenerCreateQueue.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=null==e?void 0:e.map((e=>e.payload.tag));return Lt(Yn.actions.listenerCreateQueueComplete({tags:t}))})))),(e=>e.pipe(Qt(Yn.actions.listenerDeleteQueue.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=null==e?void 0:e.map((e=>e.payload.tagId));return Lt(Yn.actions.listenerDeleteQueueComplete({tagIds:t}))})))),(e=>e.pipe(Qt(Yn.actions.listenerUpdateQueue.match),Yt(2e3),Qt((e=>e.length>0)),Vt((e=>{const t=null==e?void 0:e.map((e=>e.payload.tag));return Lt(Yn.actions.listenerUpdateQueueComplete({tags:t}))})))),(e=>e.pipe(zt(Yn.actions.listenerCreateQueueComplete.type,Yn.actions.listenerUpdateQueueComplete.type),Yt(1e3),Qt((e=>e.length>0)),Vt((()=>Lt(Yn.actions.sort()))))),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(Yn.actions.updateRequest.match),Bt(t),Vt((e=>{let[t,n]=e;var a;const{closeDialogId:l,formData:o,tag:r}=t.payload;return Lt(t).pipe(Nn(n.debug.badConnection),Qn(i,null==(a=null==o?void 0:o.name)?void 0:a.current),Vt((()=>jt(i.patch(r._id).set({name:{_type:"slug",current:null==o?void 0:o.name.current}}).commit()))),Vt((e=>Lt(Yn.actions.updateComplete({closeDialogId:l,tag:e})))),Xt((e=>Lt(Yn.actions.updateError({error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500},tag:r})))))})))}),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(jl.uploadStart.match),Vt((t=>{const{file:n,uploadItem:a}=t.payload;return Mt(Lt(null).pipe(Vt((()=>(e=>Lt(null).pipe(Vt((()=>jt(Sl(e))))))(n))),Vt((e=>Lt(jl.previewReady({blobUrl:e,hash:a.hash}))))),Lt(null).pipe(Vt((()=>Dl(i,a.assetType,n,a.hash))),Kt(e.pipe(Qt(jl.uploadCancel.match),Qt((e=>e.payload.hash===a.hash)))),Vt((e=>"complete"===(null==e?void 0:e.type)?Lt(ai.uploadComplete({asset:e.asset})):"progress"===(null==e?void 0:e.type)&&"upload"===(null==e?void 0:e.stage)?Lt(jl.uploadProgress({event:e,uploadHash:a.hash})):Ft())),Xt((e=>Lt(jl.uploadError({error:{message:(null==e?void 0:e.message)||"Internal error",statusCode:(null==e?void 0:e.statusCode)||500},hash:a.hash}))))))})))}),((e,t)=>e.pipe(Qt(jl.uploadRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{file:i,forceAsAssetType:a}=t.payload;return Lt(t).pipe(Vt((()=>Ol(i))),Qt((e=>!!!n.uploads.byIds[e])),Vt((e=>{const t={_type:"upload",assetType:a||(i.type.indexOf("image")>=0?"image":"file"),hash:e,name:i.name,size:i.size,status:"queued"};return Lt(jl.uploadStart({file:i,uploadItem:t}))})))})))),((e,t,n)=>{let{client:i}=n;return e.pipe(Qt(jl.checkRequest.match),Bt(t),Vt((e=>{let[t,n]=e;const{assets:a}=t.payload,l=a.map((e=>e._id)),o=Vn({assetTypes:n.assets.assetTypes,searchFacets:n.search.facets,searchQuery:n.search.query}),r=xt(A||(A=Y(["\n        *["," && _id in $documentIds].sha1hash\n      "])),o);return Lt(t).pipe(Nt(1e3),Vt((()=>i.observable.fetch(r,{documentIds:l}))),Vt((e=>{const t=a.reduce(((t,n)=>(t[n.sha1hash]=e.includes(n.sha1hash)?n._id:null,t)),{});return Lt(jl.checkComplete({results:t}),hi.insertUploads({results:t}))})))})))}),(e=>e.pipe(Qt(ai.uploadComplete.match),Vt((e=>Lt(jl.checkRequest({assets:[e.payload.asset]}))))))),uo=St({assets:yi,debug:ca,dialog:wi,notifications:so,search:ii,selected:lo,tags:Zn,uploads:Fl}),po=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),ho=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];var n,i;return Array.isArray(e)&&e.forEach((e=>{ho(e,t)})),po(e)&&("reference"===(null==(n=null==e?void 0:e.asset)?void 0:n._type)&&(null==(i=null==e?void 0:e.asset)?void 0:i._ref)&&t.push(e.asset._ref),Object.values(e).forEach((e=>{ho(e,t)}))),t},go=e=>{const t=ho(e);return[...new Set(t.sort())]};class mo extends vt{constructor(e){super(e);const t=Ot({dependencies:{client:e.client}});this.store=Rt({reducer:uo,middleware:e=>e({serializableCheck:!1,thunk:!1}).prepend(t),devTools:!0,preloadedState:{assets:X(X({},oi),{},{assetTypes:(null==e?void 0:e.assetType)?[e.assetType]:["file","image"]}),selected:{assets:e.selectedAssets||[],document:e.document,documentAssetIds:e.document?go(e.document):[]}}}),t.run(co)}render(){return _e(It,{store:this.store,children:this.props.children})}}const yo=()=>{var e;return bi((e=>e.tags.panelVisible))?_e(Le,{style:{position:"relative",width:250},children:_e(Le,{className:"media__custom-scrollbar",style:{borderLeft:"1px solid ".concat(null==(e=Zt.gray)?void 0:e[900].hex),height:"100%",overflowX:"hidden",overflowY:"auto",position:"absolute",right:0,top:0,width:"100%"},children:_e(gl,{})})}):null},fo=tn.div(U||(U=Y(["\n  color: white;\n  height: 100%;\n  min-height: 100%;\n  right: 0;\n  top: 0;\n  width: 100%;\n\n  &:focus {\n    outline: none;\n  }\n"]))),vo=tn.div(M||(M=Y(["\n  align-items: center;\n  background: rgba(0, 0, 0, 0.75);\n  display: flex;\n  height: 100%;\n  justify-content: center;\n  position: absolute;\n  right: 0;\n  top: 0;\n  width: 100%;\n  z-index: 3;\n"])));const bo=e=>{const{children:t}=e,{onSelect:n}=Fn(),i=wt(),a=bi((e=>e.assets.assetTypes)),l=1===a.length&&"image"===a[0],{getRootProps:o,getInputProps:r,isDragActive:s,open:d}=Tn({accept:l?"image/*":"",getFilesFromEvent:async e=>{var t;let n;if("drop"===e.type&&"dataTransfer"in e&&(n=null==(t=null==e?void 0:e.dataTransfer)?void 0:t.files),"change"===e.type){const t=null==e?void 0:e.target;(null==t?void 0:t.files)&&(n=t.files)}if(!n)return[];const a=await async function(e){const t=Array.from(e),n=[];for(const e of t)try{await e.slice(0,1).arrayBuffer(),n.push(e)}catch(e){}return n}(n);return(null==n?void 0:n.length)!==a.length&&i(ro.add({status:"error",title:"Unable to upload some items (folders and packages aren't supported)"})),a},noClick:!0,noDrag:!!n,onDrop:async e=>{e.forEach((e=>i(jl.uploadRequest({file:e,forceAsAssetType:1===a.length?a[0]:void 0}))))}});return _e(vl,{open:d,children:Se(fo,X(X({},o()),{},{children:[_e("input",X({},r())),s&&_e(vo,{children:_e(je,{direction:"column",justify:"center",style:{color:Jt.hex},children:_e(Pe,{size:3,style:{color:"inherit"},children:"Drop files to upload"})})}),t]}))})},xo=e=>{let{onClose:t}=e;const n=Pn(),i=wt(),a=e=>{const{documentId:t,result:n,transition:a}=e;"appear"===a&&i(hi.listenerCreateQueue({asset:n})),"disappear"===a&&i(hi.listenerDeleteQueue({assetId:t})),"update"===a&&i(hi.listenerUpdateQueue({asset:n}))},l=e=>{const{documentId:t,result:n,transition:a}=e;"appear"===a&&i(Kn.listenerCreateQueue({tag:n})),"disappear"===a&&i(Kn.listenerDeleteQueue({tagId:t})),"update"===a&&i(Kn.listenerUpdateQueue({tag:n}))};return ut((()=>{i(hi.loadPageIndex({pageIndex:0})),i(Kn.fetchRequest());const e=n.listen(xt(N||(N=Y(['*[_type in ["sanity.fileAsset", "sanity.imageAsset"] && !(_id in path("drafts.**"))]'])))).subscribe(a),t=n.listen(xt(V||(V=Y(['*[_type == "','" && !(_id in path("drafts.**"))]'])),qn)).subscribe(l);return()=>{null==e||e.unsubscribe(),null==t||t.unsubscribe()}}),[]),Se(bo,{children:[_e(yl,{}),_e(io,{}),_e(Ne,{display:"flex",height:"fill",children:Se(je,{direction:"column",flex:1,children:[_e(bl,{onClose:t}),_e(ra,{}),Se(je,{flex:1,children:[Se(je,{align:"flex-end",direction:"column",flex:1,style:{position:"relative"},children:[_e(ao,{}),_e(no,{})]}),_e(yo,{})]}),_e(ua,{})]})})]})},Co=e=>{const t=Pn();return _e(mo,{assetType:null==e?void 0:e.assetType,client:t,document:null==e?void 0:e.document,selectedAssets:null==e?void 0:e.selectedAssets,children:_e(lt,{scheme:"dark",theme:Me,children:_e(ot,{children:Se(jn,{onSelect:null==e?void 0:e.onSelect,children:[_e(vi,{}),_e(xo,{onClose:null==e?void 0:e.onClose})]})})})})},wo=()=>{const[e]=gt((()=>document.createElement("div")));return ut((()=>(e.classList.add("media-portal"),document.body.appendChild(e),()=>{document.body.removeChild(e)})),[]),e};var Io={title:"Media Tag",icon:la,name:qn,type:"document",fields:[{title:"Name",name:"name",type:"slug"}],preview:{select:{name:"name"},prepare(e){const{name:t}=e;return{media:la,title:null==t?void 0:t.current}}}};const To={icon:ke,name:"media",title:"Media"},ko=X(X({},To),{},{component:e=>{const{onClose:t}=e,n=wo(),i=J([]);kn("escape",t);const a=e=>{e.nativeEvent.stopImmediatePropagation(),e.stopPropagation()},{zIndex:l}=rt();return _e(st,{element:n,children:_e(dt,{children:_e(Le,{onDragEnter:a,onDragLeave:a,onDragOver:a,onDrop:a,onMouseUp:a,style:{bottom:0,height:"auto",left:0,position:"fixed",top:0,width:"100%",zIndex:l},children:_e(Co,X({document:i},e))})})})}}),_o=X(X({},To),{},{component:()=>_e(je,{direction:"column",height:"fill",flex:1,children:_e(Co,{})})}),So=ee({name:"media",form:{file:{assetSources:e=>[...e,ko]},image:{assetSources:e=>[...e,ko]}},schema:{types:[Io]},tools:e=>[...e,_o]});export{So as media,ko as mediaAssetSource};//# sourceMappingURL=index.esm.js.map
